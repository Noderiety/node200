<!DOCTYPE html>
<!-- saved from url=(0037)http://spumko.github.io/resource/api/ -->
<html class="no-js wf-omnespro-n4-active wf-proximanova-i4-active wf-proximanova-i7-active wf-proximanova-n4-active wf-proximanova-n7-active wf-proximanovasoft-n7-active wf-active"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>hapi - API Reference</title>

    <meta name="viewport" content="width=device-width">

    <link rel="stylesheet" href="http://spumko.github.io/css/main.css">
    <link rel="stylesheet" href="http://spumko.github.io/css/syntax.css">
    <link rel="stylesheet" href="http://spumko.github.io/css/overrides.css">

    <script src="./hapi_files/html5shiv.js"></script><style type="text/css">.tk-proxima-nova{font-family:"proxima-nova",sans-serif;}.tk-proxima-nova-soft{font-family:"proxima-nova-soft",sans-serif;}.tk-omnes-pro{font-family:"omnes-pro",sans-serif;}</style><link rel="stylesheet" href="http://use.typekit.net/c/b48d1b/omnes-pro:n4,proxima-nova:i4:i7:n4:n7,proxima-nova-soft:n7.X37:H:2,W0W:H:2,W0Z:H:2,W0V:H:2,W0Y:H:2,S2z:H:2/d?3bb2a6e53c9684ffdc9a9bf01e5b2a62e154b073f66dc136290177f001886c9535e576f409456e3270f503c3608d15293e6bdcdf8a1adc2cdcbe16e451d37ab7265313df1177a924a5ac3701ea36af8713bfe0fbe9e44baafcb65d9d1754da7366524d291821e1d104cdba0fe2a26965039b43e26ef3c67747eef0ff24ba46335369f85f809ede06b2231f36ba0de5ee2fd95ad817e7e7bb72ec56baf249710a53d6ed88">
</head>
<body style="">

<header class="header" role="banner">
    <div class="l-constrained">
        <h1 class="logo-small">
            <a title="Return to Home" href="http://spumko.github.io/">
                <img width="150" height="104" src="./hapi_files/logo-small.png" alt="hapi">
            </a>
        </h1>
    </div>
</header>

<section class="api" role="main">
    <div class="l-constrained">
        <div class="l-row">
            <div class="l-col1 sidebar">
                <div><ul class="1"><li><a href="http://spumko.github.io/resource/api/#hapi-server">Hapi.Server</a><ul class="2"><li><a href="http://spumko.github.io/resource/api/#new-server--host----port----options--">new Server([host], [port], [options])</a></li><li><a href="http://spumko.github.io/resource/api/#createserver--host----port----options--">createServer([host], [port], [options])</a></li><li><a href="http://spumko.github.io/resource/api/#server-options">Server options</a></li><li><a href="http://spumko.github.io/resource/api/#server-properties">Server properties</a></li><li><a href="http://spumko.github.io/resource/api/#server-methods">Server methods</a><ul class="3"><li><a href="http://spumko.github.io/resource/api/#server-start--callback--">server.start([callback])</a></li><li><a href="http://spumko.github.io/resource/api/#server-stop--options----callback--">server.stop([options], [callback])</a></li><li><a href="http://spumko.github.io/resource/api/#server-route-options-">server.route(options)</a></li><li><a href="http://spumko.github.io/resource/api/#server-route-routes-">server.route(routes)</a></li><li><a href="http://spumko.github.io/resource/api/#server-routingtable--">server.routingTable()</a></li><li><a href="http://spumko.github.io/resource/api/#server-log-tags---data---timestamp---">server.log(tags, [data, [timestamp]])</a></li><li><a href="http://spumko.github.io/resource/api/#server-state-name---options--">server.state(name, [options])</a></li><li><a href="http://spumko.github.io/resource/api/#server-views-options-">server.views(options)</a></li><li><a href="http://spumko.github.io/resource/api/#server-auth-name--options-">server.auth(name, options)</a></li><li><a href="http://spumko.github.io/resource/api/#server-ext-event--method---options--">server.ext(event, method, [options])</a></li><li><a href="http://spumko.github.io/resource/api/#server-helper-name--method---options--">server.helper(name, method, [options])</a></li><li><a href="http://spumko.github.io/resource/api/#server-inject-options--callback-">server.inject(options, callback)</a></li></ul></li><li><a href="http://spumko.github.io/resource/api/#server-events">Server events</a></li></ul></li><li><a href="http://spumko.github.io/resource/api/#request-object">Request object</a><ul class="2"><li><a href="http://spumko.github.io/resource/api/#request-properties">request properties</a></li><li><a href="http://spumko.github.io/resource/api/#request-methods">request methods</a><ul class="3"><li><a href="http://spumko.github.io/resource/api/#request-seturl-url-">request.setUrl(url)</a></li><li><a href="http://spumko.github.io/resource/api/#request-setmethod-method-">request.setMethod(method)</a></li><li><a href="http://spumko.github.io/resource/api/#request-log-tags---data---timestamp---">request.log(tags, [data, [timestamp]])</a></li><li><a href="http://spumko.github.io/resource/api/#request-getlog--tags--">request.getLog([tags])</a></li><li><a href="http://spumko.github.io/resource/api/#request-tail--name--">request.tail([name])</a></li><li><a href="http://spumko.github.io/resource/api/#request-setstate-name--value---options--">request.setState(name, value, [options])</a></li><li><a href="http://spumko.github.io/resource/api/#request-clearstate-name-">request.clearState(name)</a></li><li><a href="http://spumko.github.io/resource/api/#request-reply--result--">request.reply([result])</a></li><li><a href="http://spumko.github.io/resource/api/#request-generateview-template--context---options--">request.generateView(template, context, [options])</a></li><li><a href="http://spumko.github.io/resource/api/#request-response--">request.response()</a></li></ul></li></ul></li><li><a href="http://spumko.github.io/resource/api/#hapi-response">Hapi.response</a><ul class="3"><li><a href="http://spumko.github.io/resource/api/#flow-control">Flow control</a></li><li><a href="http://spumko.github.io/resource/api/#response-types">Response types</a><ul class="4"><li><a href="http://spumko.github.io/resource/api/#generic">Generic</a></li><li><a href="http://spumko.github.io/resource/api/#empty">Empty</a></li><li><a href="http://spumko.github.io/resource/api/#text">Text</a></li><li><a href="http://spumko.github.io/resource/api/#buffer">Buffer</a></li><li><a href="http://spumko.github.io/resource/api/#stream">Stream</a></li><li><a href="http://spumko.github.io/resource/api/#obj">Obj</a></li><li><a href="http://spumko.github.io/resource/api/#file">File</a></li><li><a href="http://spumko.github.io/resource/api/#directory">Directory</a></li><li><a href="http://spumko.github.io/resource/api/#redirection">Redirection</a></li><li><a href="http://spumko.github.io/resource/api/#view">View</a></li><li><a href="http://spumko.github.io/resource/api/#cacheable">Cacheable</a></li></ul></li></ul></li><li><a href="http://spumko.github.io/resource/api/#hapi-error">Hapi.error</a><ul class="4"><li><a href="http://spumko.github.io/resource/api/#error-transformation">Error transformation</a><ul class="5"><li><a href="http://spumko.github.io/resource/api/#badrequest--message--">badRequest([message])</a></li><li><a href="http://spumko.github.io/resource/api/#unauthorized-message---scheme---attributes---">unauthorized(message, [scheme, [attributes]])</a></li><li><a href="http://spumko.github.io/resource/api/#unauthorized-message--wwwauthenticate-">unauthorized(message, wwwAuthenticate)</a></li><li><a href="http://spumko.github.io/resource/api/#clienttimeout--message--">clientTimeout([message])</a></li><li><a href="http://spumko.github.io/resource/api/#servertimeout--message--">serverTimeout([message])</a></li><li><a href="http://spumko.github.io/resource/api/#forbidden--message--">forbidden([message])</a></li><li><a href="http://spumko.github.io/resource/api/#notfound--message--">notFound([message])</a></li><li><a href="http://spumko.github.io/resource/api/#internal--message---data---">internal([message, [data]])</a></li><li><a href="http://spumko.github.io/resource/api/#passthrough-code--payload--contenttype--headers-">passThrough(code, payload, contentType, headers)</a></li></ul></li></ul></li><li><a href="http://spumko.github.io/resource/api/#hapi-pack">Hapi.Pack</a><ul class="5"><li><a href="http://spumko.github.io/resource/api/#new-pack--options--">new Pack([options])</a></li><li><a href="http://spumko.github.io/resource/api/#pack-properties">Pack properties</a></li><li><a href="http://spumko.github.io/resource/api/#pack-methods">Pack methods</a><ul class="5"><li><a href="http://spumko.github.io/resource/api/#pack-server--host----port----options--">pack.server([host], [port], [options])</a></li><li><a href="http://spumko.github.io/resource/api/#pack-start--callback--">pack.start([callback])</a></li><li><a href="http://spumko.github.io/resource/api/#pack-stop--options----callback--">pack.stop([options], [callback])</a></li><li><a href="http://spumko.github.io/resource/api/#pack-allow-permissions-">pack.allow(permissions)</a></li><li><a href="http://spumko.github.io/resource/api/#pack-require-name---options---callback-">pack.require(name, [options], callback)</a></li><li><a href="http://spumko.github.io/resource/api/#pack-require-names--callback-">pack.require(names, callback)</a></li><li><a href="http://spumko.github.io/resource/api/#pack-register-plugin--options--callback-">pack.register(plugin, options, callback)</a></li></ul></li></ul></li><li><a href="http://spumko.github.io/resource/api/#hapi-composer">Hapi.Composer</a><ul class="5"><li><a href="http://spumko.github.io/resource/api/#new-composer-manifest-">new Composer(manifest)</a></li><li><a href="http://spumko.github.io/resource/api/#composer-compose-callback-">composer.compose(callback)</a></li><li><a href="http://spumko.github.io/resource/api/#composer-start--callback--">composer.start([callback])</a></li><li><a href="http://spumko.github.io/resource/api/#composer-stop--options----callback--">composer.stop([options], [callback])</a></li></ul></li><li><a href="http://spumko.github.io/resource/api/#plugin-interface">Plugin interface</a><ul class="5"><li><a href="http://spumko.github.io/resource/api/#exports-register-plugin--options--next-">exports.register(plugin, options, next)</a></li><li><a href="http://spumko.github.io/resource/api/#root-methods-and-properties">Root methods and properties</a><ul class="5"><li><a href="http://spumko.github.io/resource/api/#plugin-version">plugin.version</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-path">plugin.path</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-hapi">plugin.hapi</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-app">plugin.app</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-events">plugin.events</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-log-tags---data---timestamp---">plugin.log(tags, [data, [timestamp]])</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-dependency-deps-">plugin.dependency(deps)</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-views-options-">plugin.views(options)</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-helper-name--method---options--">plugin.helper(name, method, [options])</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-cache-options-">plugin.cache(options)</a></li></ul></li><li><a href="http://spumko.github.io/resource/api/#selectable-methods-and-properties">Selectable methods and properties</a><ul class="5"><li><a href="http://spumko.github.io/resource/api/#plugin-select-labels-">plugin.select(labels)</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-length">plugin.length</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-api-key--value-">plugin.api(key, value)</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-api-obj-">plugin.api(obj)</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-route-options-">plugin.route(options)</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-route-routes-">plugin.route(routes)</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-state-name---options--">plugin.state(name, [options])</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-auth-name--options-">plugin.auth(name, options)</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-ext-event--method---options--">plugin.ext(event, method, [options])</a></li></ul></li></ul></li><li><a href="http://spumko.github.io/resource/api/#hapi-utils">Hapi.utils</a><ul class="5"><li><a href="http://spumko.github.io/resource/api/#version--">version()</a></li></ul></li><li><a href="http://spumko.github.io/resource/api/#hapi-types">Hapi.types</a></li><li><a href="http://spumko.github.io/resource/api/#hapi-state">Hapi.state</a><ul class="5"><li><a href="http://spumko.github.io/resource/api/#preparevalue-name--value--options--callback-">prepareValue(name, value, options, callback)</a></li></ul></li></ul></div>
            </div>
            <div class="l-col2 main">
    
                <h1>API Reference</h1>

                <div class="api-toc"><ul class="1"><li><a href="http://spumko.github.io/resource/api/#hapi-server">Hapi.Server</a><ul class="2"><li><a href="http://spumko.github.io/resource/api/#new-server--host----port----options--">new Server([host], [port], [options])</a></li><li><a href="http://spumko.github.io/resource/api/#createserver--host----port----options--">createServer([host], [port], [options])</a></li><li><a href="http://spumko.github.io/resource/api/#server-options">Server options</a></li><li><a href="http://spumko.github.io/resource/api/#server-properties">Server properties</a></li><li><a href="http://spumko.github.io/resource/api/#server-methods">Server methods</a><ul class="3"><li><a href="http://spumko.github.io/resource/api/#server-start--callback--">server.start([callback])</a></li><li><a href="http://spumko.github.io/resource/api/#server-stop--options----callback--">server.stop([options], [callback])</a></li><li><a href="http://spumko.github.io/resource/api/#server-route-options-">server.route(options)</a></li><li><a href="http://spumko.github.io/resource/api/#server-route-routes-">server.route(routes)</a></li><li><a href="http://spumko.github.io/resource/api/#server-routingtable--">server.routingTable()</a></li><li><a href="http://spumko.github.io/resource/api/#server-log-tags---data---timestamp---">server.log(tags, [data, [timestamp]])</a></li><li><a href="http://spumko.github.io/resource/api/#server-state-name---options--">server.state(name, [options])</a></li><li><a href="http://spumko.github.io/resource/api/#server-views-options-">server.views(options)</a></li><li><a href="http://spumko.github.io/resource/api/#server-auth-name--options-">server.auth(name, options)</a></li><li><a href="http://spumko.github.io/resource/api/#server-ext-event--method---options--">server.ext(event, method, [options])</a></li><li><a href="http://spumko.github.io/resource/api/#server-helper-name--method---options--">server.helper(name, method, [options])</a></li><li><a href="http://spumko.github.io/resource/api/#server-inject-options--callback-">server.inject(options, callback)</a></li></ul></li><li><a href="http://spumko.github.io/resource/api/#server-events">Server events</a></li></ul></li><li><a href="http://spumko.github.io/resource/api/#request-object">Request object</a><ul class="2"><li><a href="http://spumko.github.io/resource/api/#request-properties">request properties</a></li><li><a href="http://spumko.github.io/resource/api/#request-methods">request methods</a><ul class="3"><li><a href="http://spumko.github.io/resource/api/#request-seturl-url-">request.setUrl(url)</a></li><li><a href="http://spumko.github.io/resource/api/#request-setmethod-method-">request.setMethod(method)</a></li><li><a href="http://spumko.github.io/resource/api/#request-log-tags---data---timestamp---">request.log(tags, [data, [timestamp]])</a></li><li><a href="http://spumko.github.io/resource/api/#request-getlog--tags--">request.getLog([tags])</a></li><li><a href="http://spumko.github.io/resource/api/#request-tail--name--">request.tail([name])</a></li><li><a href="http://spumko.github.io/resource/api/#request-setstate-name--value---options--">request.setState(name, value, [options])</a></li><li><a href="http://spumko.github.io/resource/api/#request-clearstate-name-">request.clearState(name)</a></li><li><a href="http://spumko.github.io/resource/api/#request-reply--result--">request.reply([result])</a></li><li><a href="http://spumko.github.io/resource/api/#request-generateview-template--context---options--">request.generateView(template, context, [options])</a></li><li><a href="http://spumko.github.io/resource/api/#request-response--">request.response()</a></li></ul></li></ul></li><li><a href="http://spumko.github.io/resource/api/#hapi-response">Hapi.response</a><ul class="3"><li><a href="http://spumko.github.io/resource/api/#flow-control">Flow control</a></li><li><a href="http://spumko.github.io/resource/api/#response-types">Response types</a><ul class="4"><li><a href="http://spumko.github.io/resource/api/#generic">Generic</a></li><li><a href="http://spumko.github.io/resource/api/#empty">Empty</a></li><li><a href="http://spumko.github.io/resource/api/#text">Text</a></li><li><a href="http://spumko.github.io/resource/api/#buffer">Buffer</a></li><li><a href="http://spumko.github.io/resource/api/#stream">Stream</a></li><li><a href="http://spumko.github.io/resource/api/#obj">Obj</a></li><li><a href="http://spumko.github.io/resource/api/#file">File</a></li><li><a href="http://spumko.github.io/resource/api/#directory">Directory</a></li><li><a href="http://spumko.github.io/resource/api/#redirection">Redirection</a></li><li><a href="http://spumko.github.io/resource/api/#view">View</a></li><li><a href="http://spumko.github.io/resource/api/#cacheable">Cacheable</a></li></ul></li></ul></li><li><a href="http://spumko.github.io/resource/api/#hapi-error">Hapi.error</a><ul class="4"><li><a href="http://spumko.github.io/resource/api/#error-transformation">Error transformation</a><ul class="5"><li><a href="http://spumko.github.io/resource/api/#badrequest--message--">badRequest([message])</a></li><li><a href="http://spumko.github.io/resource/api/#unauthorized-message---scheme---attributes---">unauthorized(message, [scheme, [attributes]])</a></li><li><a href="http://spumko.github.io/resource/api/#unauthorized-message--wwwauthenticate-">unauthorized(message, wwwAuthenticate)</a></li><li><a href="http://spumko.github.io/resource/api/#clienttimeout--message--">clientTimeout([message])</a></li><li><a href="http://spumko.github.io/resource/api/#servertimeout--message--">serverTimeout([message])</a></li><li><a href="http://spumko.github.io/resource/api/#forbidden--message--">forbidden([message])</a></li><li><a href="http://spumko.github.io/resource/api/#notfound--message--">notFound([message])</a></li><li><a href="http://spumko.github.io/resource/api/#internal--message---data---">internal([message, [data]])</a></li><li><a href="http://spumko.github.io/resource/api/#passthrough-code--payload--contenttype--headers-">passThrough(code, payload, contentType, headers)</a></li></ul></li></ul></li><li><a href="http://spumko.github.io/resource/api/#hapi-pack">Hapi.Pack</a><ul class="5"><li><a href="http://spumko.github.io/resource/api/#new-pack--options--">new Pack([options])</a></li><li><a href="http://spumko.github.io/resource/api/#pack-properties">Pack properties</a></li><li><a href="http://spumko.github.io/resource/api/#pack-methods">Pack methods</a><ul class="5"><li><a href="http://spumko.github.io/resource/api/#pack-server--host----port----options--">pack.server([host], [port], [options])</a></li><li><a href="http://spumko.github.io/resource/api/#pack-start--callback--">pack.start([callback])</a></li><li><a href="http://spumko.github.io/resource/api/#pack-stop--options----callback--">pack.stop([options], [callback])</a></li><li><a href="http://spumko.github.io/resource/api/#pack-allow-permissions-">pack.allow(permissions)</a></li><li><a href="http://spumko.github.io/resource/api/#pack-require-name---options---callback-">pack.require(name, [options], callback)</a></li><li><a href="http://spumko.github.io/resource/api/#pack-require-names--callback-">pack.require(names, callback)</a></li><li><a href="http://spumko.github.io/resource/api/#pack-register-plugin--options--callback-">pack.register(plugin, options, callback)</a></li></ul></li></ul></li><li><a href="http://spumko.github.io/resource/api/#hapi-composer">Hapi.Composer</a><ul class="5"><li><a href="http://spumko.github.io/resource/api/#new-composer-manifest-">new Composer(manifest)</a></li><li><a href="http://spumko.github.io/resource/api/#composer-compose-callback-">composer.compose(callback)</a></li><li><a href="http://spumko.github.io/resource/api/#composer-start--callback--">composer.start([callback])</a></li><li><a href="http://spumko.github.io/resource/api/#composer-stop--options----callback--">composer.stop([options], [callback])</a></li></ul></li><li><a href="http://spumko.github.io/resource/api/#plugin-interface">Plugin interface</a><ul class="5"><li><a href="http://spumko.github.io/resource/api/#exports-register-plugin--options--next-">exports.register(plugin, options, next)</a></li><li><a href="http://spumko.github.io/resource/api/#root-methods-and-properties">Root methods and properties</a><ul class="5"><li><a href="http://spumko.github.io/resource/api/#plugin-version">plugin.version</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-path">plugin.path</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-hapi">plugin.hapi</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-app">plugin.app</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-events">plugin.events</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-log-tags---data---timestamp---">plugin.log(tags, [data, [timestamp]])</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-dependency-deps-">plugin.dependency(deps)</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-views-options-">plugin.views(options)</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-helper-name--method---options--">plugin.helper(name, method, [options])</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-cache-options-">plugin.cache(options)</a></li></ul></li><li><a href="http://spumko.github.io/resource/api/#selectable-methods-and-properties">Selectable methods and properties</a><ul class="5"><li><a href="http://spumko.github.io/resource/api/#plugin-select-labels-">plugin.select(labels)</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-length">plugin.length</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-api-key--value-">plugin.api(key, value)</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-api-obj-">plugin.api(obj)</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-route-options-">plugin.route(options)</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-route-routes-">plugin.route(routes)</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-state-name---options--">plugin.state(name, [options])</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-auth-name--options-">plugin.auth(name, options)</a></li><li><a href="http://spumko.github.io/resource/api/#plugin-ext-event--method---options--">plugin.ext(event, method, [options])</a></li></ul></li></ul></li><li><a href="http://spumko.github.io/resource/api/#hapi-utils">Hapi.utils</a><ul class="5"><li><a href="http://spumko.github.io/resource/api/#version--">version()</a></li></ul></li><li><a href="http://spumko.github.io/resource/api/#hapi-types">Hapi.types</a></li><li><a href="http://spumko.github.io/resource/api/#hapi-state">Hapi.state</a><ul class="5"><li><a href="http://spumko.github.io/resource/api/#preparevalue-name--value--options--callback-">prepareValue(name, value, options, callback)</a></li></ul></li></ul></div>
                <h2 id="hapi-server"><code>Hapi.Server</code></h2>

<h3 id="new-server--host----port----options--"><code>new Server([host], [port], [options])</code></h3>

<p>Creates a new server instance with the following arguments:</p>

<ul>
<li><code>host</code> - the hostname or IP address the server is bound to. Defaults to <code>0.0.0.0</code> which means any available network
interface. Set to <code>127.0.0.1</code> or <code>localhost</code> to restrict connection to those coming from the same machine.</li>
<li><code>port</code> - the TPC port the server is listening to. Defaults to port <code>80</code> for HTTP and to <code>443</code> when TLS is configured.
to use an ephemeral port, use <code>0</code> and once the server is started, retrieve the port allocation via <code>server.info.port</code>.</li>
<li><code>options</code> - An object with the server configuration as described in <a href="http://spumko.github.io/resource/api/#server-options">server options</a>.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="mi">8000</span><span class="p">,</span> <span class="p">{</span> <span class="nx">cors</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
</code></pre></div>
<h3 id="createserver--host----port----options--"><code>createServer([host], [port], [options])</code></h3>

<p>An alternative method for creating a server instance using the same arguments as <code>new Server()</code>.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="mi">8000</span><span class="p">,</span> <span class="p">{</span> <span class="nx">cors</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
</code></pre></div>
<h3 id="server-options">Server options</h3>

<p>When creating a server instance, the following options configure the server's behavior:</p>

<ul>
<li><code>app</code> - application-specific configuration. Provides a safe place to store application configuration without potential conflicts with <strong>hapi</strong>.
Should not be used by plugins which should use <code>plugins[name]</code>.
<p></p></li>
<li><code>auth</code> - configures one or more authentication strategies. The <code>auth</code> key can be set to a single strategy object (the name will default to <code>'default'</code>),
or to an object with multiple strategies where the strategy name is the object key. The authentication strategies and their options are described in
<a href="http://spumko.github.io/resource/api/#serverauthname-options"><code>server.auth()</code></a>.
<p></p></li>
<li><a name="server.config.cache"></a><code>cache</code> - determines the type of server-side cache used. Every server includes a cache for storing and reusing request
responses and helper results. By default a simple memory-based cache is used which has very limited capacity and is not suitable for production
environments. In addition to the memory cache, a Redis-based or a MongoDB-based cache can be configured. Actual caching is only utilized if routes,
helpers, and plugins are explicitly configured to store their state in the cache. The server cache configuration only defines the store itself. The
<code>cache</code> options are described in the <a href="https://github.com/spumko/catbox#client"><strong>catbox</strong> module documentation</a>.
<p></p></li>
<li><code>cors</code> - the <a href="http://www.w3.org/TR/cors/">Cross-Origin Resource Sharing</a> protocol allows browsers to make cross-origin API calls. CORS is
required by web application running inside a browser which are loaded from a different domain than the API server. CORS headers are disabled by
default. To enable, set <code>cors</code> to <code>true</code>, or to an object with the following options:

<ul>
<li><code>origin</code> - a strings array of allowed origin servers ('Access-Control-Allow-Origin'). Defaults to any origin <code>['*']</code>.</li>
<li><code>maxAge</code> - number of seconds the browser should cache the CORS response ('Access-Control-Max-Age'). The greater the value, the longer it
will take before the browser checks for changes in policy. Defaults to <code>86400</code> (one day).</li>
<li><code>headers</code> - a strings array of allowed headers ('Access-Control-Allow-Headers'). Defaults to <code>['Authorization', 'Content-Type', 'If-None-Match']</code>.</li>
<li><code>additionalHeaders</code> - a strings array of additional headers to <code>headers</code>. Use this to keep the default headers in place.</li>
<li><code>methods</code> - a strings array of allowed HTTP methods ('Access-Control-Allow-Methods'). Defaults to <code>['GET', 'HEAD', 'POST', 'PUT', 'DELETE', 'OPTIONS']</code>.</li>
<li><code>additionalMethods</code> - a strings array of additional methods to <code>methods</code>. Use this to keep the default methods in place.</li>
<li><code>exposedHeaders</code> - a strings array of exposed headers ('Access-Control-Expose-Headers'). Defaults to <code>['WWW-Authenticate', 'Server-Authorization']</code>.</li>
<li><code>additionalExposedHeaders</code> - a strings array of additional headers to <code>exposedHeaders</code>. Use this to keep the default headers in place.</li>
<li><code>credentials</code> - if <code>true</code>, allows user credentials to be sent ('Access-Control-Allow-Credentials'). Defaults to <code>false</code>.
<p></p></li>
</ul></li>
<li><code>debug</code> - controls the error types sent to the console:

<ul>
<li><code>request</code> - a string array of request log tags to be displayed via <code>console.error()</code> when the events are logged via <code>request.log()</code>. Defaults
to uncaught errors thrown in external code (these errors are handled automatically and result in an Internal Server Error (500) error response.
For example, to display all errors, change the option to <code>['error', 'uncaught']</code>. To turn off all console debug messages set it to <code>false</code>.
<p></p></li>
</ul></li>
<li><a name="server.config.files"></a><code>files</code> - defines the behavior for serving static resources using the built-in route handlers for files and directories:

<ul>
<li><code>relativeTo</code> - determines how relative paths are resolved. Available values:

<ul>
<li><code>'cwd'</code> - relative paths are resolved using the active process path (<code>process.cwd()</code>). This is the default setting.</li>
<li><code>'routes'</code> - relative paths are resolved relative to the source file in which the <code>server.route()</code> method is called. This means the
location of the source code determines the location of the static resources when using relative paths.</li>
<li>an absolute path (e.g. '/path') used as prefix for all relative paths.
<p></p></li>
</ul></li>
</ul></li>
<li><code>labels</code> - a string array of labels used when registering plugins to <a href="http://spumko.github.io/resource/api/#pluginselectlabels"><code>plugin.select()</code></a> matching server labels. Defaults
to an empty array <code>[]</code> (no labels).
<p></p></li>
<li><a name="server.config.location"></a><code>location</code> - used to convert relative 'Location' header URIs to absolute, by adding this value as prefix. Value must not contain a trailing <code>'/'</code>.
Defaults to the host received in the request HTTP 'Host' header and if missing, to <code>server.info.uri</code>.
<p></p></li>
<li><a name="server.config.payload"></a><code>payload</code> - controls how incoming payloads (request body) are processed:

<ul>
<li><code>maxBytes</code> - limits the size of incoming payloads to the specified byte count. Allowing very large payloads may cause the server to run
out of memory. Defaults to <code>1048576</code> (1MB).
<p></p></li>
</ul></li>
<li><code>plugins</code> - plugin-specific configuration. Provides a place to store and pass plugin configuration that is at server-level. The <code>plugins</code> is
an object where each key is a plugin name and the value is the configuration.
<p></p></li>
<li><a name="server.config.router"></a><code>router</code> - controls how incoming request URIs are matched against the routing table:

<ul>
<li><code>isCaseSensitive</code> - determines whether the paths '/example' and '/EXAMPLE' are considered different resources. Defaults to <code>true</code>.</li>
<li><code>normalizeRequestPath</code> - determines whether request paths should be normalized prior to matching. Normalization percent-encodes reserved
characters, decodes unreserved characters, and capitalizes any percent encoded values. Useful when serving non-compliant HTTP clients.
Defaults to <code>false</code>.
<p></p></li>
</ul></li>
<li><a name="server.config.state"></a><code>state</code> - HTTP state management (cookies) allows the server to store information on the client which is sent back to the server with every
request (as defined in <a href="https://tools.ietf.org/html/rfc6265">RFC 6265</a>).

<ul>
<li><code>cookies</code> - The server automatically parses incoming cookies based on these options:

<ul>
<li><code>parse</code> - determines if incoming 'Cookie' headers are parsed and stored in the <code>request.cookies</code> object. Defaults to <code>true</code>.</li>
<li><code>failAction</code> - determines how to handle cookie parsing errors. Allowed values are:

<ul>
<li><code>'error'</code> - return a Bad Request (400) error response. This is the default value.</li>
<li><code>'log'</code> - report the error but continue processing the request.</li>
<li><code>'ignore'</code> - take no action.</li>
</ul></li>
<li><code>clearInvalid</code> - if <code>true</code>, automatically instruct the client to remove invalid cookies. Defaults to <code>false</code>.</li>
<li><code>strictHeader</code> - if <code>false</code>, allows any cookie value including values in violation of <a href="https://tools.ietf.org/html/rfc6265">RFC 6265</a>. Defaults to <code>true</code>.
<p></p></li>
</ul></li>
</ul></li>
<li><code>timeout</code> - define timeouts for processing durations:

<ul>
<li><code>server</code> - response timeout in milliseconds. Sets the maximum time allowed for the server to respond to an incoming client request before giving
up and responding with a Service Unavailable (503) error response. Disabled by default (<code>false</code>).</li>
<li><code>client</code> - request timeout in milliseconds. Sets the maximum time allowed for the client to transmit the request payload (body) before giving up
and responding with a Request Timeout (408) error response. Set to <code>false</code> to disable. Defaults to <code>10000</code> (10 seconds).</li>
<li><code>socket</code> - by default, node sockets automatically timeout after 2 minutes. Use this option to override this behavior. Defaults to <code>undefined</code>
which leaves the node default unchanged. Set to <code>false</code> to disable socket timeouts.
<p></p></li>
</ul></li>
<li><code>tls</code> - used to create an HTTPS server. The <code>tls</code> object is passed unchanged as options to the node.js HTTPS server as described in the
<a href="http://nodejs.org/api/https.html#https_https_createserver_options_requestlistener">node.js HTTPS documentation</a>.
<p></p></li>
<li><code>maxSockets</code> - used to set the number of sockets available per outgoing host connection.  Default is null.  This impacts all servers sharing the process.
<p></p></li>
<li><a name="server.config.views"></a><code>views</code> - enables support for view rendering (using templates to generate responses). Disabled by default.
To enable, set to an object with the following options:

<ul>
<li><code>engines</code> - (required) an object where each key is a file extension (e.g. 'html', 'jade'), mapped to the npm module name (string) used for
rendering the templates. Alternatively, the extension can be mapped to an object with the following options:

<ul>
<li><code>module</code> - the npm module name (string) to require or an object with:

<ul>
<li><code>compile()</code> - the rendering function. The required function signature depends on the <code>compileMode</code> settings. If the <code>compileMode</code> is
<code>'sync'</code>, the signature is <code>compile(template, options)</code>, the return value is a function with signature <code>function(context, options)</code>,
and the method is allowed to throw errors. If the <code>compileMode</code> is <code>'async'</code>, the signature is <code>compile(template, options, callback)</code>
where <code>callback</code> has the signature <code>function(err, compiled)</code> where <code>compiled</code> is a function with signature <code>function(context, options)</code>.</li>
</ul></li>
<li>any of the <code>views</code> options listed below (except <code>defaultExtension</code>) to override the defaults for a specific engine.</li>
</ul></li>
<li><code>defaultExtension</code> - defines the default filename extension to append to template names when multiple engines are configured and not
explicit extension is provided for a given template. No default value.</li>
<li><code>path</code> - the root file path used to resolve and load the templates identified when calling <code>request.reply.view()</code>. Defaults to current working
directory.</li>
<li><code>partialsPath</code> - the root file path where partials are located. Partials are small segments of template code that can be nested and reused
throughout other templates. Defaults to no partials support (empty path).</li>
<li><code>helpersPath</code> - the directory path where helpers are located. Helpers are functions used within templates to perform transformations
and other data manipulations using the template context or other inputs. Each '.js' file in the helpers directory is loaded and the file name
is used as the helper name. The files must export a single method with the signature <code>function(context)</code> and return a string. Sub-folders are
not supported and are ignored. Defaults to no helpers support (empty path).</li>
<li><code>basePath</code> - a base path used as prefix for <code>path</code> and <code>partialsPath</code>. No default.</li>
<li><code>layout</code> - if set to <code>true</code>, layout support is enabled. A layout is a single template file used as the parent template for other view templates
in the same engine. The layout template name must be 'layout.ext' where 'ext' is the engine's extension.  Disable 'layout' when using Jade as
it will handle including any layout files independently of Hapi.  Defaults to <code>false</code>.</li>
<li><code>layoutKeyword</code> - the key used by the template engine to denote where primary template content should go. Defaults to <code>'content'</code>.</li>
<li><code>encoding</code> - the text encoding used by the templates when reading the files and outputting the result. Defaults to <code>'utf-8'</code>.</li>
<li><code>isCached</code> - if set to <code>false</code>, templates will not be cached (thus will be read from file on every use). Defaults to <code>true</code>.</li>
<li><code>allowAbsolutePaths</code> - if set to <code>true</code>, allows absolute template paths passed to <code>request.reply.view()</code>. Defaults to <code>false</code>.</li>
<li><code>allowInsecureAccess</code> - if set to <code>true</code>, allows template paths passed to <code>request.reply.view()</code> to contain '../'. Defaults to <code>false</code>.</li>
<li><code>compileOptions</code> - options object passed to the engine's compile function. Defaults to empty options <code>{}</code>.</li>
<li><code>runtimeOptions</code> - options object passed to the returned function from the compile operation. Defaults to empty options <code>{}</code>.</li>
<li><code>contentType</code> - the content type of the engine results. Defaults to <code>'text/html'</code>.</li>
<li><code>compileMode</code> - specify whether the engine <code>compile()</code> method is <code>'sync'</code> or <code>'async'</code>. Defaults to <code>'sync'</code>.</li>
</ul></li>
</ul>

<h3 id="server-properties"><code>Server</code> properties</h3>

<p>Each instance of the <code>Server</code> object have the following properties:</p>

<ul>
<li><code>app</code> - application-specific state. Provides a safe place to store application data without potential conflicts with <strong>hapi</strong>.
Should not be used by plugins which should use <code>plugins[name]</code>.</li>
<li><code>helpers</code> - helper functions registered with <a href="http://spumko.github.io/resource/api/#serverhelpername-method-options"><code>server.helper()</code></a>.</li>
<li><code>info</code> - server information:

<ul>
<li><code>port</code> - the port the server was configured to (before <code>start()</code>) or bound to (after <code>start()</code>).</li>
<li><code>host</code> - the hostname the server was configured to (defaults to <code>'0.0.0.0'</code> if no host was provided).</li>
<li><code>protocol</code> - the protocol used (e.g. <code>'http'</code> or <code>'https'</code>).</li>
<li><code>uri</code> - a string with the following format: 'protocol://host:port' (e.g. '<a href="http://example.com:8080'/">http://example.com:8080'</a>).</li>
</ul></li>
<li><code>listener</code> - the node HTTP server object.</li>
<li><code>pack</code> - the <a href="http://spumko.github.io/resource/api/#hapipack"><code>Pack</code></a> object the server belongs to (automatically assigned when creating a server instance directly).</li>
<li><code>plugins</code> - an object where each key is a plugin name and the value is the API registered by that plugin using <a href="http://spumko.github.io/resource/api/#pluginapikey-value"><code>plugin.api()</code></a>.</li>
<li><code>settings</code> - an object containing the <a href="http://spumko.github.io/resource/api/#server-options">server options</a> after applying the defaults.</li>
</ul>

<h3 id="server-methods"><code>Server</code> methods</h3>

<h4 id="server-start--callback--"><code>server.start([callback])</code></h4>

<p>Starts the server by listening for incoming connections on the configured port. If provided, <code>callback()</code> is called once the server is
ready for new connections. If the server is already started, the <code>callback()</code> is called on the next tick.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">();</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Server started at: '</span> <span class="o">+</span> <span class="nx">server</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">uri</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="server-stop--options----callback--"><code>server.stop([options], [callback])</code></h4>

<p>Stops the server by refusing to accept any new connections. Existing connections will continue until closed or timeout (defaults to 5 seconds).
Once the server stopped, all the connections have ended, and it is safe to exit the process, the callback (if provided) is called. If the server
is already stopped, the <code>callback()</code> is called on the next tick.</p>

<p>The optional <code>options</code> object supports:</p>

<ul>
<li><code>timeout</code> - overrides the timeout in millisecond before forcefully terminating a connection. Defaults to <code>5000</code> (5 seconds).</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">server</span><span class="p">.</span><span class="nx">stop</span><span class="p">({</span> <span class="nx">timeout</span><span class="o">:</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span> <span class="p">},</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Server stopped'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="server-route-options-"><code>server.route(options)</code></h4>

<p>Adds a new route to the server where:</p>

<ul>
<li><code>options</code> - the route configuration as described in <a href="http://spumko.github.io/resource/api/#route-options">route options</a>.</li>
</ul>

<h5 id="toc_9">Route options</h5>

<p>The following options are available when adding a route:</p>

<ul>
<li><code>path</code> - (required) the absolute path used to match incoming requests (must begin with '/'). Incoming requests are compared to the configured
paths based on the server <a href="http://spumko.github.io/resource/api/#server.config.router"><code>router</code></a> configuration option. The path can include named parameters enclosed in <code>{}</code> which
will be matched against literal values in the request as described in <a href="http://spumko.github.io/resource/api/#path-parameters">Path parameters</a>.
<p></p></li>
<li><code>method</code> - (required) the HTTP method. Typically one of 'GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS'. Any HTTP method is allowed, except for 'HEAD'.
Use <code>*</code> to match against any HTTP method (only when an exact match was not found).
<p></p></li>
<li><code>vhost</code> - an optional domain string or an array of domain strings for limiting the route to only requests with a matching host header field.
Matching is done against the hostname part of the header only (excluding the port). Defaults to all hosts.
<p></p></li>
<li><code>handler</code> - (required) the function called to generate the response after successful authentication and validation. The handler function is
described in <a href="http://spumko.github.io/resource/api/#route-handler">Route handler</a>. Alternatively, <code>handler</code> can be set to the string <code>'notfound'</code> to return a Not Found (404)
error response, or <code>handler</code> can be assigned an object with one of:

<ul>
<li><a name="route.config.file"></a><code>file</code> - generates a static file endpoint for serving a single file. <code>file</code> can be set to:

<ul>
<li>a relative or absolute file path string (relative paths are resolved based on the server <a href="http://spumko.github.io/resource/api/#server.config.files"><code>files</code></a> configuration).</li>
<li>a function with the signature <code>function(request)</code> which returns the relative or absolute file path.</li>
<li>an object with the following options:

<ul>
<li><code>path</code> - a path string or function as described above.</li>
<li><code>mode</code> - specifies whether to include the 'Content-Disposition' header with the response. Available values:

<ul>
<li><code>false</code> - header is not included. This is the default value.</li>
<li><code>'attachment'</code></li>
<li><code>'inline'</code>
<p></p></li>
</ul></li>
</ul></li>
</ul></li>
<li><a name="route.config.directory"></a><code>directory</code> - generates a directory endpoint for serving static content from a directory. Routes using the directory handler must include a
single path parameter at the end of the path string (e.g. '/path/to/somewhere/{param}' where the parameter name does not matter). The path
parameter can use any of the parameter options (e.g. '{param}' for one level files only, '{param?}' for one level files or the directory root,
'{param*}' for any level, or '{param*3}' for a specific level). The directory handler is an object with the following options:

<ul>
<li><code>path</code> - (required) the directory root path (relative paths are resolved based on the server <a href="http://spumko.github.io/resource/api/#server.config.files"><code>files</code></a> configuration).
Value can be:

<ul>
<li>a single path string used as the prefix for any resources requested by appending the request path parameter to the provided string.</li>
<li>an array of path strings. Each path will be attempted in order until a match is found (by following the same process as the single path string).</li>
<li>a function with the signature <code>function(request)</code> which returns the path string.</li>
</ul></li>
<li><code>index</code> - optional boolean, determines if 'index.html' will be served if found in the folder when requesting a directory. Defaults to <code>true</code>.</li>
<li><code>listing</code> - optional boolean, determines if directory listing is generated when a directory is requested without an index document.
Defaults to <code>false</code>.</li>
<li><code>showHidden</code> - optional boolean, determines if hidden files will be shown and served. Defaults to <code>false</code>.</li>
<li><code>redirectToSlash</code> - optional boolean, determines if requests for a directory without a trailing slash are redirected to the same path with
the missing slash. Useful for ensuring relative links inside the response are resolved correctly.
<p></p></li>
</ul></li>
<li><code>proxy</code> - generates a reverse proxy handler with the following options:

<ul>
<li><code>host</code> - the upstream service host to proxy requests to.  The same path on the client request will be used as the path on the host.</li>
<li><code>port</code> - the upstream service port.</li>
<li><code>protocol</code> - The protocol to use when making a request to the proxied host:

<ul>
<li><code>'http'</code></li>
<li><code>'https'</code></li>
</ul></li>
<li><code>passThrough</code> - if <code>true</code>, forwards the headers sent from the client to the upstream service being proxied to. Defaults to <code>false</code>.</li>
<li><code>rejectUnauthorized</code> - sets the <em>'rejectUnauthorized'</em> property on the https <a href="http://nodejs.org/api/https.html#https_https_request_options_callback">agent</a> making the request.
This value is only used when the proxied server uses TLS/SSL.  When set it will override the node.js <em>'rejectUnauthorized'</em> property.  If <em>'false'</em> then ssl errors will be ignored.
When <em>'true'</em> the server certificate is verified and an 500 response will be sent when verification fails.  Defaults to the https agent default value of <em>'true'</em>.</li>
<li><code>xforward</code> - if <code>true</code>, sets the 'X-Forwarded-For', 'X-Forwarded-Port', 'X-Forwarded-Proto' headers when making a request to the
proxied upstream endpoint. Defaults to <code>false</code>.</li>
<li><code>redirects</code> - the maximum number of HTTP redirections allowed, to be followed automatically by the handler. Set to <code>false</code> or <code>0</code> to
disable all redirections (the response will contain the redirection received from the upstream service). If redirections are enabled,
no redirections (301, 302, 307, 308) will be passed along to the client, and reaching the maximum allowed redirections will return an
error response. Defaults to <code>false</code>.</li>
<li><code>mapUri</code> - a function used to map the request URI to the proxied URI. Cannot be used together with <code>host</code>, <code>port</code>, or <code>protocol</code>.
The function signature is <code>function(request, callback)</code> where:

<ul>
<li><code>request</code> - is the incoming <code>request</code> object</li>
<li><code>callback</code> - is <code>function(err, uri, headers)</code> where:

<ul>
<li><code>err</code> - internal error condition.</li>
<li><code>uri</code> - the absolute proxy URI.</li>
<li><code>headers</code> - optional object where each key is an HTTP request header and the value is the header content.</li>
</ul></li>
</ul></li>
<li><code>postResponse</code> - a custom function for processing the response from the upstream service before sending to the client. Useful for
custom error handling of responses from the proxied endpoint or other payload manipulation. Function signature is
<code>function(request, settings, res, payload)</code> where:

<ul>
<li><code>request</code> - is the incoming <code>request</code> object. It is the responsibility of the <code>postResponse()</code> function to call <code>request.reply()</code>.</li>
<li><code>settings</code> - the proxy handler configuration.</li>
<li><code>res</code> - the node response object received from the upstream service.</li>
<li><code>payload</code> - the response payload.
<p></p></li>
</ul></li>
</ul></li>
<li><a name="route.config.view"></a><code>view</code> - generates a template-based response. The <code>view</code> options is set to the desired template file name.
The view context available to the template includes:

<ul>
<li><code>payload</code> - maps to <code>request.payload</code>.</li>
<li><code>params</code> - maps to <code>request.params</code>.</li>
<li><code>query</code> - maps to <code>request.query</code>.
<p></p></li>
</ul></li>
</ul></li>
<li><code>config</code> - additional route configuration (the <code>config</code> options allows splitting the route information from its implementation):

<ul>
<li><code>handler</code> - an alternative location for the route handler function. Same as the <code>handler</code> option in the parent level. Can only
include one handler per route.
<p></p></li>
<li><code>pre</code> - an array with prerequisites methods which are executed in serial or in parallel before the handler is called and are
described in <a href="http://spumko.github.io/resource/api/#route-prerequisites">Route prerequisites</a>.
<p></p></li>
<li><code>validate</code>

<ul>
<li><code>query</code> - validation rules for an incoming request URI query component (the key-value part of the URI between '?' and '#').
The query is parsed into its individual key-value pairs (see
<a href="http://nodejs.org/api/querystring.html#querystring_querystring_parse_str_sep_eq_options">Query String</a>) and stored in
<code>request.query</code> prior to validation. Values allowed:

<ul>
<li><code>true</code> - any query parameters allowed (no validation performed). This is the default.</li>
<li><code>false</code> - no query parameters allowed.</li>
<li>a validation rules object as described in the <a href="http://github.com/spumko/joi">Joi</a> module.
<p></p></li>
</ul></li>
<li><code>payload</code> - validation rules for an incoming request payload (request body). Values allowed:

<ul>
<li><code>true</code> - any payload allowed (no validation performed). This is the default.</li>
<li><code>false</code> - no payload allowed.</li>
<li>a validation rules object as described in the <a href="http://github.com/spumko/joi">Joi</a> module.
<p></p></li>
</ul></li>
<li><code>path</code> - validation rules for incoming request path parameters, after matching the path against the route and extracting any
parameters then stored in <code>request.params</code>. Values allowed:

<ul>
<li><code>true</code> - any path parameters allowed (no validation performed).  This is the default.</li>
<li><code>false</code> - no path variables allowed.</li>
<li>a validation rules object as described in the <a href="http://github.com/spumko/joi">Joi</a> module.
<p></p></li>
</ul></li>
<li><code>response</code> - validation rules for the outgoing response payload (response body). Can only validate <a href="http://spumko.github.io/resource/api/#obj">object</a> response. Values allowed:

<ul>
<li><code>true</code> - any payload allowed (no validation performed). This is the default.</li>
<li><code>false</code> - no payload allowed.</li>
<li>an object with the following options:

<ul>
<li><code>schema</code> - the validation schema as described in the <a href="http://github.com/spumko/joi"></a> module.</li>
<li><code>sample</code> - the percent of responses validated (0 - 100). Set to <code>0</code> to disable all validation. Defaults to <code>100</code> (all responses).</li>
<li><code>failAction</code> - defines what to do when a response fails validation. Options are:

<ul>
<li></li>
<li></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li><code>payload</code> - determines how the request payload is processed. <code>payload</code> can be assigned a string with the parsing mode directly (e.g. <code>'parse'</code>)
which will use the default values of the other settings, or an object with the following:

<ul>
<li><code>mode</code> - the parsing mode. Defaults to <code>'parse'</code> if <code>validate.payload</code> is set or when <code>method</code> is
<code>'POST'</code>, <code>'PUT'</code> or <code>'PATCH'</code>, otherwise <code>'stream'</code>. Payload processing is configured using the server <a href="http://spumko.github.io/resource/api/#server.config.payload"><code>payload</code></a> configuration.
Options are:

<ul>
<li><code>'stream'</code> - the incoming request stream is left untouched, leaving it up to the handler to process the request via <code>request.raw.req</code>.</li>
<li><code>'raw'</code> - the payload is read and stored in <code>request.rawPayload</code> as a <code>Buffer</code> and is not parsed.</li>
<li><code>'parse'</code> - the payload is read and stored in <code>request.rawPayload</code> as a <code>Buffer</code>, and then parsed (JSON or form-encoded) and stored
in <code>request.payload</code>. Parsing is performed based on the incoming request 'Content-Type' header. If the parsing is enabled and the
format is unknown, a Bad Request (400) error response is sent. The supported mime types are:

<ul>
<li>application/json</li>
<li>application/x-www-form-urlencoded</li>
<li>application/octet-stream</li>
<li>multipart/form-data (<a href="https://npmjs.org/package/formidable"></a> is used for processing this data and is capable of
receiving files as well as other form data.  All values are assigned to their respective form names in <code>request.payload</code>.</li>
</ul></li>
<li><code>'try'</code> - same as <code>'parse'</code> but does not return an error on failed parsing. Instead, leaves <code>request.payload</code> undefined.</li>
</ul></li>
<li><code>allow</code> - a string or an array of strings with the allowed mime types for the endpoint. Defaults to any of the supported mime types listed
above. Note that allowing other mime types not listed will not enable them to be parsed, and that if parsing mode is <code>'parse'</code>, the request
will result in an error response.</li>
<li><code>override</code> - a mime type string overriding the 'Content-Type' header value received. Defaults to no override.
<p></p></li>
</ul></li>
<li><code>cache</code> - if the route method is 'GET', the route can be configured to use the cache. The <code>cache</code> options are described in
the <a href="https://github.com/spumko/catbox#policy"><strong>catbox</strong> module documentation</a> with some additions:

<ul>
<li><code>mode</code> - cache location. Available values:

<ul>
<li><code>'client'</code> - caching is performed on the client by sending the HTTP <code>Cache-Control</code> header. This is the default value.</li>
<li><code>'server'</code> - caching is performed on the server using the cache strategy configured.</li>
<li><code>'client+server'</code> - caching it performed on both the client and server.</li>
</ul></li>
<li><code>segment</code> - optional segment name, used to isolate cached items within the cache partition. Defaults to the route fingerprint
(the route path with parameters represented by a <code>'?'</code> character). Note that when using the MongoDB cache strategy, some paths
will require manual override as their fingerprint will conflict with MongoDB collection naming rules. When setting segment
names manually, the segment must begin with <code>'//'</code>.</li>
<li><code>privacy</code> - determines the privacy flag included in client-side caching using the 'Cache-Control' header. Values are:

<ul>
<li><code>'default'</code> - no privacy flag. This is the default setting.</li>
<li><code>'public'</code> - mark the response as suitable for public caching.</li>
<li><code>'private'</code> - mark the response as suitable only for private caching.</li>
</ul></li>
<li><code>expiresIn</code> - relative expiration expressed in the number of milliseconds since the item was saved in the cache. Cannot be used
together with <code>expiresAt</code>.</li>
<li><code>expiresAt</code> - time of day expressed in 24h notation using the 'MM:HH' format, at which point all cache records for the route
expire. Cannot be used together with <code>expiresIn</code>.</li>
<li><code>staleIn</code> - number of milliseconds to mark an item stored in cache as stale and reload it. Must be less than <code>expiresIn</code>. Available
only when using server-side caching.</li>
<li><code>staleTimeout</code> - number of milliseconds to wait before checking if an item is stale. Available only when using server-side caching.
<p></p></li>
</ul></li>
<li><code>auth</code> - authentication configuration. Value can be:

<ul>
<li>a string with the name of an authentication strategy registered with <code>server.auth()</code>.</li>
<li>a boolean where <code>false</code> means no authentication, and <code>true</code> sets to the default authentication strategy which is available only
when a single strategy is configured.</li>
<li>an object with:

<ul>
<li><code>mode</code> - the authentication mode. Defaults to <code>'required'</code> if a server authentication strategy is configured, otherwise defaults
to no authentication. Available values:

<ul>
<li><code>'required'</code> - authentication is required.</li>
<li><code>'optional'</code> - authentication is optional (must be valid if present).</li>
<li><code>'try'</code> - same as <code>'optional'</code> but allows for invalid authentication.</li>
</ul></li>
<li><code>strategies</code> - a string array of strategy names in order they should be attempted. If only one strategy is used, <code>strategy</code> can
be used instead with the single string value. Defaults to the default authentication strategy which is available only when a single
strategy is configured.</li>
<li><code>payload</code> - if set, the payload (in requests other than 'GET' and 'HEAD') is authenticated after it is processed. Requires a strategy
with payload authentication support (e.g. <a href="http://spumko.github.io/resource/api/#hawk-authentication">Hawk</a>). Available values:

<ul>
<li><code>false</code> - no payload authentication. This is the default value.</li>
<li><code>'required'</code> - payload authentication required.</li>
<li><code>'optional'</code> - payload authentication performed only when the client includes payload authentication information (e.g.
<code>hash</code> attribute in Hawk).</li>
</ul></li>
<li><code>tos</code> - minimum terms-of-service version required (uses the <a href="https://npmjs.org/package/semver">semver</a> module). If defined, the
authentication credentials object must include a <code>tos</code> key which satisfies this requirement. Defaults to <code>false</code> which means no validation.</li>
<li><code>scope</code> - required application scope. A scope string which must be included in the authentication credentials object in <code>scope</code> which is
a string array. Defaults to no scope required.</li>
<li><code>entity</code> - the required authenticated entity type. If set, must match the <code>entity</code> value of the authentication credentials. Available
values:

<ul>
<li><code>any</code> - the authentication can be on behalf of a user or application. This is the default value.</li>
<li><code>user</code> - the authentication must be on behalf of a user.</li>
<li><code>app</code> - the authentication must be on behalf of an application.
<p></p></li>
</ul></li>
</ul></li>
</ul></li>
<li><code>jsonp</code> - enables JSONP support by setting the value to the query parameter name containing the function name used to wrap the response payload.
For example, if the value is <code>'callback'</code>, a request comes in with <code>'callback=me'</code>, and the JSON response is <code>'{ "a":"b" }'</code>, the payload will be:
<code>'me({ "a":"b" });'</code>.
<p></p></li>
<li><code>description</code> - route description used for generating documentation (string).</li>
<li><code>notes</code> - route notes used for generating documentation (string or array of strings).</li>
<li><code>tags</code> - route tags used for generating documentation (array of strings).</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">();</span>

<span class="c1">// Handler in top level</span>

<span class="kd">var</span> <span class="nx">status</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s1">'ok'</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/status'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">status</span> <span class="p">});</span>

<span class="c1">// Handler in config</span>

<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">cache</span><span class="o">:</span> <span class="p">{</span> <span class="nx">expiresIn</span><span class="o">:</span> <span class="mi">5000</span> <span class="p">},</span>
    <span class="nx">handler</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">'John'</span> <span class="p">});</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/user'</span><span class="p">,</span> <span class="nx">config</span><span class="o">:</span> <span class="nx">user</span> <span class="p">});</span>
</code></pre></div>
<h5 id="toc_10">Path processing</h5>

<p>The router iterates through the routing table on each incoming request and executes the first (and only the first) matching route. Route
matching is done on the request path only (excluding the query and other URI components). Requests are matches in a deterministic order where
the order in which routes are added does not matter. The routes are sorted from the most specific to the most generic. For example, the following
path array shows the order in which an incoming request path will be matched against the routes:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">paths</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'/'</span><span class="p">,</span>
    <span class="s1">'/a'</span><span class="p">,</span>
    <span class="s1">'/b'</span><span class="p">,</span>
    <span class="s1">'/ab'</span><span class="p">,</span>
    <span class="s1">'/{p}'</span><span class="p">,</span>
    <span class="s1">'/a/b'</span><span class="p">,</span>
    <span class="s1">'/a/{p}'</span><span class="p">,</span>
    <span class="s1">'/b/'</span><span class="p">,</span>
    <span class="s1">'/a/b/c'</span><span class="p">,</span>
    <span class="s1">'/a/b/{p}'</span><span class="p">,</span>
    <span class="s1">'/a/{p}/b'</span><span class="p">,</span>
    <span class="s1">'/a/{p}/c'</span><span class="p">,</span>
    <span class="s1">'/a/{p*2}'</span><span class="p">,</span>
    <span class="s1">'/a/b/c/d'</span><span class="p">,</span>
    <span class="s1">'/a/b/{p*2}'</span><span class="p">,</span>
    <span class="s1">'/a/{p}/b/{x}'</span><span class="p">,</span>
    <span class="s1">'/{p*5}'</span><span class="p">,</span>
    <span class="s1">'/a/b/{p*}'</span><span class="p">,</span>
    <span class="s1">'/{p*}'</span>
<span class="p">];</span>
</code></pre></div>
<h5 id="toc_11">Path parameters</h5>

<p>Parameterized paths are processed by matching the named parameters to the content of the incoming request path at that path segment. For example,
'/book/{id}/cover' will match '/book/123/cover' and <code>request.params.id</code> will be set to <code>'123'</code>. Each path segment (everything between the opening '/' and
 the closing '/' unless it is the end of the path) can only include one named parameter.</p>

<p>An optional '?' suffix following the parameter name indicates an optional parameter (only allowed if the parameter is at the ends of the path).
 For example, the route '/book/{id?}' matches '/book/'.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">getAlbum</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s1">'You asked for '</span> <span class="o">+</span>
                <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">song</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">song</span> <span class="o">+</span> <span class="s1">' from '</span> <span class="o">:</span> <span class="s1">''</span><span class="p">)</span> <span class="o">+</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">album</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
    <span class="nx">path</span><span class="o">:</span> <span class="s1">'/{album}/{song?}'</span><span class="p">,</span>
    <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span>
    <span class="nx">handler</span><span class="o">:</span> <span class="nx">getAlbum</span>
<span class="p">});</span>
</code></pre></div>
<p>In addition to the optional '?' suffix, a parameter name can also specify the number of matching segments using the '*' suffix, followed by a number
greater than 1. If the number of expected parts can be anything, then use '*' without a number (matching any number of segments can only be used in the
last path segment).</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">getPerson</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">nameParts</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'/'</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">({</span> <span class="nx">first</span><span class="o">:</span> <span class="nx">nameParts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">last</span><span class="o">:</span> <span class="nx">nameParts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">});</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
    <span class="nx">path</span><span class="o">:</span> <span class="s1">'/person/{name*2}'</span><span class="p">,</span>   <span class="c1">// Matches '/person/john/doe'</span>
    <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span>
    <span class="nx">handler</span><span class="o">:</span> <span class="nx">getPerson</span>
<span class="p">});</span>
</code></pre></div>
<h5 id="toc_12">Route handler</h5>

<p>When a route is matched against an incoming request, the route handler is called and passed a reference to the <a href="http://spumko.github.io/resource/api/#request-object">request</a> object.
The handler method must call <a href="http://spumko.github.io/resource/api/#requestreplyresult"><code>request.reply()</code></a> or one of its sub-methods to return control back to the router.</p>

<p>Route handler functions can use one of three declaration styles:</p>

<p>No arguments (the <code>request</code> object is bound to <code>this</code>, decorated by the <code>reply</code> interface):</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s1">'success'</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<p>One argument (the request is passed as an argument, decorated by the <code>reply</code> interface):</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">request</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s1">'success'</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<p>Two arguments (the request and the <code>reply</code> interface are passed as arguments):</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">reply</span><span class="p">(</span><span class="s1">'success'</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<p>The two-arguments style is provided for symmetry with extension functions and prerequisite functions where the function
signature is <code>function(request, next)</code>. In order to enable interchangeable use of these functions, the two argument style does
not provide any of the <a href="http://spumko.github.io/resource/api/#requestreplyresult"><code>request.reply</code></a> decorations.</p>

<h5 id="toc_13">Route prerequisites</h5>

<p>It is often necessary to perform prerequisite actions before the handler is called (e.g. load required reference data from a database).
The route <code>pre</code> option allows defining such pre-handler methods. The methods are called in order, unless a <code>mode</code> is specified with value
<code>'parallel'</code> in which case, all the parallel methods are executed first, then the rest in order. <code>pre</code> can be assigned a mixed array of:</p>

<ul>
<li>objects with:

<ul>
<li><code>method</code> - the function to call (or short-hand helper string as described below). The function signature is <code>function(request, next)</code> where:

<ul>
<li><code>request</code> - the incoming <code>request</code> object.</li>
<li><code>next</code> - the function called when the method is done with the signature <code>function(result)</code> where:

<ul>
<li><code>result</code> - any return value including an <code>Error</code> object (created via <code>new Error()</code> or <a href="http://spumko.github.io/resource/api/#hapierror"><code>Hapi.error</code></a>). If an error
is returned, that value is sent back to the client and the handler method is not called.</li>
</ul></li>
</ul></li>
<li><code>assign</code> - key name to assign the result of the function to within <code>request.pre</code>.</li>
<li><code>mode</code> - set the calling order of the function. Available values:

<ul>
<li><code>'serial'</code> - serial methods are executed after all the <code>'parallel'</code> methods in the order listed. This is the default value.</li>
<li><code>'parallel'</code> - all parallel methods are executed first in parallel before any serial method. The first to return an error response
will exist the set.</li>
</ul></li>
</ul></li>
<li>functions - same as including an object with a single <code>method</code> key.</li>
<li>strings - special short-hand notation for <a href="http://spumko.github.io/resource/api/#serverhelpername-method-options">registered server helpers</a> using the format 'name(args)'
(e.g. <code>'user(params.id)'</code>) where:

<ul>
<li>'name' - the helper name. The name is also used as the default value of <code>assign</code>.</li>
<li>'args' - the helper arguments (excluding <code>next</code>) where each argument is a property of <code>request</code>.</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">pre1</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">next</span><span class="p">(</span><span class="s1">'Hello'</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">pre2</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">next</span><span class="p">(</span><span class="s1">'World'</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">pre3</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">next</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">pre</span><span class="p">.</span><span class="nx">m1</span> <span class="o">+</span> <span class="s1">' '</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">pre</span><span class="p">.</span><span class="nx">m2</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
    <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span>
    <span class="nx">path</span><span class="o">:</span> <span class="s1">'/'</span><span class="p">,</span>
    <span class="nx">config</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">pre</span><span class="o">:</span> <span class="p">[</span>
            <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="nx">pre1</span><span class="p">,</span> <span class="nx">assign</span><span class="o">:</span> <span class="s1">'m1'</span><span class="p">,</span> <span class="nx">mode</span><span class="o">:</span> <span class="s1">'parallel'</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="nx">pre2</span><span class="p">,</span> <span class="nx">assign</span><span class="o">:</span> <span class="s1">'m2'</span><span class="p">,</span> <span class="nx">mode</span><span class="o">:</span> <span class="s1">'parallel'</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="nx">pre3</span><span class="p">,</span> <span class="nx">assign</span><span class="o">:</span> <span class="s1">'m3'</span> <span class="p">},</span>
        <span class="p">],</span>
        <span class="nx">handler</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pre</span><span class="p">.</span><span class="nx">m3</span> <span class="o">+</span> <span class="s1">'\n'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<h5 id="toc_14">Route not found</h5>

<p>If the application needs to override the default Not Found (404) error response, it can add a catch-all route for a specific
method or all methods. Only one catch-all route can be defined per server instance.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s1">'The page was not found'</span><span class="p">).</span><span class="nx">code</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'*'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/{p*}'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">handler</span> <span class="p">});</span>
</code></pre></div>
<h4 id="server-route-routes-"><code>server.route(routes)</code></h4>

<p>Same as <a href="http://spumko.github.io/resource/api/#serverrouteoptions">server.route(options)</a> where <code>routes</code> is an array of route options.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">([</span>
    <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/status'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">status</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/user'</span><span class="p">,</span> <span class="nx">config</span><span class="o">:</span> <span class="nx">user</span> <span class="p">}</span>
<span class="p">]);</span>
</code></pre></div>
<h4 id="server-routingtable--"><code>server.routingTable()</code></h4>

<p>Returns a copy of the routing table. The return value is an array of routes where each route contains:</p>

<ul>
<li><code>settings</code> - the route config with defaults applied.</li>
<li><code>method</code> - the HTTP method in lower case.</li>
<li><code>path</code> - the route path.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">table</span> <span class="o">=</span> <span class="nx">server</span><span class="p">.</span><span class="nx">routingTable</span><span class="p">()</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">table</span><span class="p">);</span>

<span class="cm">/*  Output:</span>

<span class="cm">    [{</span>
<span class="cm">        method: 'get',</span>
<span class="cm">        path: '/test/{p}/end',</span>
<span class="cm">        settings: {</span>
<span class="cm">            handler: [Function],</span>
<span class="cm">            method: 'get',</span>
<span class="cm">            plugins: {},</span>
<span class="cm">            app: {},</span>
<span class="cm">            validate: {},</span>
<span class="cm">            payload: 'stream',</span>
<span class="cm">            auth: undefined,</span>
<span class="cm">            cache: [Object] }</span>
<span class="cm">    }] */</span>
</code></pre></div>
<h4 id="server-log-tags---data---timestamp---"><code>server.log(tags, [data, [timestamp]])</code></h4>

<p>The <code>server.log()</code> method is used for logging server events that cannot be associated with a specific request. When called the server emits a <code>'log'</code>
event which can be used by other listeners or plugins to record the information or output to the console. The arguments are:</p>

<ul>
<li><code>tags</code> - a string or an array of strings (e.g. <code>['error', 'database', 'read']</code>) used to identify the event. Tags are used instead of log levels
and provide a much more expressive mechanism for describing and filtering events. Any logs generated by the server internally include the <code>'hapi'</code>
tag along with event-specific information.</li>
<li><code>data</code> - an optional message string or object with the application data being logged.</li>
<li><code>timestamp</code> - an optional timestamp expressed in milliseconds. Defaults to <code>Date.now()</code> (now).</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">();</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'log'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">tags</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">tags</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">log</span><span class="p">([</span><span class="s1">'test'</span><span class="p">,</span> <span class="s1">'error'</span><span class="p">],</span> <span class="s1">'Test event'</span><span class="p">);</span>
</code></pre></div>
<h4 id="server-state-name---options--"><code>server.state(name, [options])</code></h4>

<p><a href="http://tools.ietf.org/html/rfc6265">HTTP state management</a> uses client cookies to persist a state across multiple requests. Cookie definitions
can be registered with the server using the <code>server.state()</code> method, where:</p>

<ul>
<li><code>name</code> - is the cookie name.</li>
<li><code>options</code> - are the optional cookie settings:

<ul>
<li><code>ttl</code> - time-to-live in milliseconds. Defaults to <code>null</code> (session time-life - cookies are deleted when the browser is closed).</li>
<li><code>isSecure</code> - sets the 'Secure' flag. Defaults to <code>false</code>.</li>
<li><code>isHttpOnly</code> - sets the 'HttpOnly' flag. Defaults to <code>false</code>.</li>
<li><code>path</code> - the path scope. Defaults to <code>null</code> (no path).</li>
<li><code>domain</code> - the domain scope. Defaults to <code>null</code> (no domain).</li>
<li><code>autoValue</code> - if present and the cookie was not received from the client or explicitly set by the route handler, the cookie is automatically
added to the response with the provided value.</li>
<li><code>encoding</code> - encoding performs on the provided value before serialization. Options are:

<ul>
<li><code>'none'</code> - no encoding. When used, the cookie value must be a string. This is the default value.</li>
<li><code>'base64'</code> - string value is encoded using Base64.</li>
<li><code>'base64json'</code> - object value is JSON-stringified than encoded using Base64.</li>
<li><code>'form'</code> - object value is encoded using the <em>x-www-form-urlencoded</em> method.</li>
<li><code>'iron'</code> - Encrypts and sign the value using <a href="https://github.com/hueniverse/iron"><strong>iron</strong></a>.</li>
</ul></li>
<li><code>sign</code> - an object used to calculate an HMAC for cookie integrity validation. This does not provide privacy, only a mean to verify that the cookie value
was generated by the server. Redundant when <code>'iron'</code> encoding is used. Options are:

<ul>
<li><code>integrity</code> - algorithm options. Defaults to <a href="https://github.com/hueniverse/iron#options"><code>require('iron').defaults.integrity</code></a>.</li>
<li><code>password</code> - password used for HMAC key generation.</li>
</ul></li>
<li><code>password</code> - password used for <code>'iron'</code> encoding.</li>
<li><code>iron</code> - options for <code>'iron'</code> encoding. Defaults to <a href="https://github.com/hueniverse/iron#options"><code>require('iron').defaults</code></a>.</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="c1">// Set cookie definition</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="s1">'session'</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">ttl</span><span class="o">:</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>     <span class="c1">// One day</span>
    <span class="nx">isSecure</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">path</span><span class="o">:</span> <span class="s1">'/'</span><span class="p">,</span>
    <span class="nx">encoding</span><span class="o">:</span> <span class="s1">'base64json'</span>
<span class="p">});</span>

<span class="c1">// Set state in route handler</span>

<span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">session</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">session</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">session</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">session</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">user</span><span class="o">:</span> <span class="s1">'joe'</span> <span class="p">};</span>
    <span class="p">}</span>

    <span class="nx">session</span><span class="p">.</span><span class="nx">last</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s1">'Success'</span><span class="p">).</span><span class="nx">state</span><span class="p">(</span><span class="s1">'session'</span><span class="p">,</span> <span class="nx">session</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<p>Registered cookies are automatically parsed when received. Parsing rules depends on the server <a href="http://spumko.github.io/resource/api/#server.config.state"><code>state.cookies</code></a> configuration.
If an incoming registered cookie fails parsing, it is not included in <code>request.state</code>, regardless of the <code>state.cookies.failAction</code> setting.
When <code>state.cookies.failAction</code> is set to <code>'log'</code> and an invalid cookie value is received, the server will emit a <code>'request'</code> event. To capture these errors
subscribe to the <code>'request'</code> events and filter on <code>'error'</code> and <code>'state'</code> tags:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'request'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">tags</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">tags</span><span class="p">.</span><span class="nx">error</span> <span class="o">&amp;&amp;</span> <span class="nx">tags</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="server-views-options-"><code>server.views(options)</code></h4>

<p>Initializes the server views manager programmatically instead of via the server <a href="http://spumko.github.io/resource/api/#server.config.views"><code>views</code></a> configuration option.
The <code>options</code> object is the same as the server <a href="http://spumko.github.io/resource/api/#server.config.views"><code>views</code></a> config object.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">server</span><span class="p">.</span><span class="nx">views</span><span class="p">({</span>
    <span class="nx">engines</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">html</span><span class="o">:</span> <span class="s1">'handlebars'</span><span class="p">,</span>
        <span class="nx">jade</span><span class="o">:</span> <span class="s1">'jade'</span>
    <span class="p">},</span>
    <span class="nx">path</span><span class="o">:</span> <span class="s1">'/static/templates'</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="server-auth-name--options-"><code>server.auth(name, options)</code></h4>

<p>Registers an authentication strategy where:</p>

<ul>
<li><code>name</code> - is the strategy name (<code>'default'</code> is automatically assigned if a single strategy is registered via the server <code>auth</code> config).</li>
<li><code>options</code> - required strategy options. Each scheme comes with its own set of required options, in addition to the options sharedby all schemes:

<ul>
<li><code>scheme</code> - (required, except when <code>implementation</code> is used) the built-in scheme name. Available values:

<ul>
<li><code>'basic'</code> - <a href="http://spumko.github.io/resource/api/#basic-authentication">HTTP Basic authentication</a> (<a href="http://tools.ietf.org/html/rfc2617">RFC 2617</a>)</li>
<li><code>'cookie'</code> - <a href="http://spumko.github.io/resource/api/#cookie-authentication">cookie authentication</a></li>
<li><code>'hawk'</code> - <a href="http://spumko.github.io/resource/api/#hawk-authentication">HTTP Hawk authentication</a> (<a href="https://github.com/hueniverse/hawk">Hawk protocol</a>)</li>
<li><code>'bewit'</code> - <a href="http://spumko.github.io/resource/api/#bewit-authentication">URI Bewit (Hawk)</a> query authentication (<a href="https://github.com/hueniverse/hawk">Hawk protocol</a>)</li>
</ul></li>
<li><code>implementation</code> -  an object with the <strong>hapi</strong> authentication scheme interface (use the <code>'hawk'</code> implementation as template). Cannot be used together with <code>scheme</code>.</li>
<li><code>defaultMode</code> - if <code>true</code>, the scheme is automatically assigned as a required strategy to any route without an <code>auth</code> config. Can only be assigned to a single
server strategy. Value must be <code>true</code> (which is the same as <code>'required'</code>) or a valid authentication mode (<code>'required'</code>, <code>'optional'</code>, <code>'try'</code>). Defaults to <code>false</code>.</li>
</ul></li>
</ul>

<h5 id="toc_21">Basic authentication</h5>

<p>Basic authentication requires validating a username and password combination. The <code>'basic'</code> scheme takes the following required options:</p>

<ul>
<li><code>scheme</code> - set to <code>'basic'</code>.</li>
<li><code>validateFunc</code> - a user lookup and password validation function with the signature <code>function(username, password, callback)</code> where:

<ul>
<li><code>username</code> - the username received from the client.</li>
<li><code>password</code> - the password received from the client.</li>
<li><code>callback</code> - a callback function with the signature <code>function(err, isValid, credentials)</code> where:

<ul>
<li><code>err</code> - an internal error.</li>
<li><code>isValid</code> - <code>true</code> if both the username was found and the password matched, otherwise <code>false</code>.</li>
<li><code>credentials</code> - a credentials object passed back to the application in <code>request.auth.credentials</code>. Typically, <code>credentials</code> are only
included when <code>isValid</code> is <code>true</code>, but there are cases when the application needs to know who tried to authenticate even when it fails
(e.g. with authentication mode <code>'try'</code>).</li>
</ul></li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Bcrypt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'bcrypt'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">users</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">john</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">username</span><span class="o">:</span> <span class="s1">'john'</span><span class="p">,</span>
        <span class="nx">password</span><span class="o">:</span> <span class="s1">'$2a$10$iqJSHD.BGr0E2IxQwYgJmeP3NvhPrXAeLSaGCj6IR/XU5QtjVu5Tm'</span><span class="p">,</span>   <span class="c1">// 'secret'</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">'John Doe'</span><span class="p">,</span>
        <span class="nx">id</span><span class="o">:</span> <span class="s1">'2133d32a'</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">validate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">[</span><span class="nx">username</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">Bcrypt</span><span class="p">.</span><span class="nx">compare</span><span class="p">(</span><span class="nx">password</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">isValid</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">isValid</span><span class="p">,</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span> <span class="p">});</span>
    <span class="p">});</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">auth</span><span class="p">(</span><span class="s1">'simple'</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">scheme</span><span class="o">:</span> <span class="s1">'basic'</span><span class="p">,</span>
    <span class="nx">validateFunc</span><span class="o">:</span> <span class="nx">validate</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/'</span><span class="p">,</span> <span class="nx">config</span><span class="o">:</span> <span class="p">{</span> <span class="nx">auth</span><span class="o">:</span> <span class="s1">'simple'</span> <span class="p">}</span> <span class="p">});</span>
</code></pre></div>
<h5 id="toc_22">Cookie authentication</h5>

<p>Cookie authentication provides a simple cookie-based session management. The user has to be authenticated via other means, typically a web
form, and upon successful authentication, receive a reply with a session cookie. Subsequent requests containing the session cookie are authenticated
(the cookie uses <a href="https://github.com/hueniverse/iron">Iron</a> to encrypt and sign the session content) and validated via the provided <code>validateFunc</code>
in case the cookie's encrypted content requires validation on each request. Note that cookie operates as a bearer token and anyone in possession
of the cookie content can use it to impersonate its true owner. The <code>'cookie</code>' scheme takes the following required options:</p>

<ul>
<li><code>scheme</code> - set to <code>'cookie'</code>.</li>
<li><code>cookie</code> - the cookie name. Defaults to <code>'sid'</code>.</li>
<li><code>password</code> - used for Iron cookie encoding.</li>
<li><code>ttl</code> - sets the cookie expires time in milliseconds. Defaults to single browser session (ends when browser closes).</li>
<li><code>clearInvalid</code> - if <code>true</code>, any authentication cookie that fails validation will be marked as expired in the response and cleared. Defaults to <code>false</code>.</li>
<li><code>isSecure</code> - if <code>false</code>, the cookie is allowed to be transmitted over insecure connections which exposes it to attacks. Defaults to <code>true</code>.</li>
<li><code>isHttpOnly</code> - if <code>false</code>, the cookie will not include the 'HttpOnly' flag. Defaults to <code>true</code>.</li>
<li><code>redirectTo</code> - optional login URI to redirect unauthenticated requests to. Defaults to no redirection.</li>
<li><code>appendNext</code> - if <code>true</code> and <code>redirectTo</code> is <code>true</code>, appends the current request path to the query component of the <code>redirectTo</code> URI using the
parameter name <code>'next'</code>. Set to a string to use a different parameter name. Defaults to <code>false</code>.</li>
<li><code>validateFunc</code> - an optional session validation function used to validate the content of the session cookie on each request. Used to verify that the
internal session state is still valid (e.g. user account still exists). The function has the signature <code>function(session, callback)</code> where:

<ul>
<li><code>session</code> - is the session object set via <code>request.auth.session.set()</code>.</li>
<li><code>callback</code> - a callback function with the signature <code>function(err, isValid, credentials)</code> where:

<ul>
<li><code>err</code> - an internal error.</li>
<li><code>isValid</code> - <code>true</code> if the content of the session is valid, otherwise <code>false</code>.</li>
<li><code>credentials</code> - a credentials object passed back to the application in <code>request.auth.credentials</code>. If value is <code>null</code> or <code>undefined</code>,
defaults to <code>session</code>. If set, will override the current cookie as if <code>request.auth.session.set()</code> was called.</li>
</ul></li>
</ul></li>
</ul>

<p>When the cookie scheme is enabled on a route, the <code>request.auth.session</code> objects is decorated with two methods:</p>

<ul>
<li><code>set(session)</code> - sets the current session. Must be called after a successful login to begin the session. <code>session</code> must be a non-null object,
which is set on successful subsequent authentications in <code>request.auth.credentials</code>.</li>
<li><code>clear()</code> - clears the current session. Used to logout a user.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">users</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">john</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">id</span><span class="o">:</span> <span class="s1">'john'</span><span class="p">,</span>
        <span class="nx">password</span><span class="o">:</span> <span class="s1">'password'</span><span class="p">,</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">'John Doe'</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">home</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s1">'&lt;html&gt;&lt;head&gt;&lt;title&gt;Login page&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h3&gt;Welcome '</span>
      <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">credentials</span><span class="p">.</span><span class="nx">name</span>
      <span class="o">+</span> <span class="s1">'!&lt;/h3&gt;&lt;br/&gt;&lt;form method="get" action="/logout"&gt;'</span>
      <span class="o">+</span> <span class="s1">'&lt;input type="submit" value="Logout"&gt;'</span>
      <span class="o">+</span> <span class="s1">'&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;'</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">login</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">'/'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">account</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">method</span> <span class="o">===</span> <span class="s1">'post'</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">username</span> <span class="o">||</span>
            <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">password</span><span class="p">)</span> <span class="p">{</span>

            <span class="nx">message</span> <span class="o">=</span> <span class="s1">'Missing username or password'</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">account</span> <span class="o">=</span> <span class="nx">users</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">username</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">account</span> <span class="o">||</span>
                <span class="nx">account</span><span class="p">.</span><span class="nx">password</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">password</span><span class="p">)</span> <span class="p">{</span>

                <span class="nx">message</span> <span class="o">=</span> <span class="s1">'Invalid username or password'</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">method</span> <span class="o">===</span> <span class="s1">'get'</span> <span class="o">||</span>
        <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s1">'&lt;html&gt;&lt;head&gt;&lt;title&gt;Login page&lt;/title&gt;&lt;/head&gt;&lt;body&gt;'</span>
            <span class="o">+</span> <span class="p">(</span><span class="nx">message</span> <span class="o">?</span> <span class="s1">'&lt;h3&gt;'</span> <span class="o">+</span> <span class="nx">message</span> <span class="o">+</span> <span class="s1">'&lt;/h3&gt;&lt;br/&gt;'</span> <span class="o">:</span> <span class="s1">''</span><span class="p">)</span>
            <span class="o">+</span> <span class="s1">'&lt;form method="post" action="/login"&gt;'</span>
            <span class="o">+</span> <span class="s1">'Username: &lt;input type="text" name="username"&gt;&lt;br&gt;'</span>
            <span class="o">+</span> <span class="s1">'Password: &lt;input type="password" name="password"&gt;&lt;br/&gt;'</span>
            <span class="o">+</span> <span class="s1">'&lt;input type="submit" value="Login"&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">account</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">'/'</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">logout</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">'/'</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="mi">8000</span><span class="p">);</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">auth</span><span class="p">(</span><span class="s1">'session'</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">scheme</span><span class="o">:</span> <span class="s1">'cookie'</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="s1">'secret'</span><span class="p">,</span>
    <span class="nx">cookie</span><span class="o">:</span> <span class="s1">'sid-example'</span><span class="p">,</span>
    <span class="nx">redirectTo</span><span class="o">:</span> <span class="s1">'/login'</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">([</span>
    <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/'</span><span class="p">,</span> <span class="nx">config</span><span class="o">:</span> <span class="p">{</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">home</span><span class="p">,</span> <span class="nx">auth</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'*'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/login'</span><span class="p">,</span> <span class="nx">config</span><span class="o">:</span> <span class="p">{</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">login</span><span class="p">,</span> <span class="nx">auth</span><span class="o">:</span> <span class="p">{</span> <span class="nx">mode</span><span class="o">:</span> <span class="s1">'try'</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/logout'</span><span class="p">,</span> <span class="nx">config</span><span class="o">:</span> <span class="p">{</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">logout</span><span class="p">,</span> <span class="nx">auth</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">]);</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</code></pre></div>
<h5 id="toc_23">Hawk authentication</h5>

<p><a href="https://github.com/hueniverse/hawk">Hawk authentication</a> provides a holder-of-key authentication scheme. The scheme supports payload
authentication. The scheme requires the following options:</p>

<ul>
<li><code>scheme</code> - set to <code>'hawk'</code>.</li>
<li><code>getCredentialsFunc</code> - credential lookup function with the signature <code>function(id, callback)</code> where:

<ul>
<li><code>id</code> - the Hawk credentials identifier.</li>
<li><code>callback</code> - the callback function with signature <code>function(err, credentials)</code> where:

<ul>
<li><code>err</code> - an internal error.</li>
<li><code>credentials</code> - a credentials object passed back to the application in <code>request.auth.credentials</code>. Return <code>null</code> or <code>undefined</code> to
indicate unknown credentials (which is not considered an error state).</li>
</ul></li>
</ul></li>
<li><code>hawk</code> - optional protocol options passed to <code>Hawk.server.authenticate()</code>.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">credentials</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">d74s3nz2873n</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">key</span><span class="o">:</span> <span class="s1">'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn'</span><span class="p">,</span>
        <span class="nx">algorithm</span><span class="o">:</span> <span class="s1">'sha256'</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">getCredentials</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">credentials</span><span class="p">[</span><span class="nx">id</span><span class="p">]);</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">auth</span><span class="p">(</span><span class="s1">'hawk'</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">scheme</span><span class="o">:</span> <span class="s1">'hawk'</span><span class="p">,</span>
    <span class="nx">getCredentialsFunc</span><span class="o">:</span> <span class="nx">getCredentials</span>
<span class="p">});</span>
</code></pre></div>
<h5 id="toc_24">Bewit authentication</h5>

<p><a href="https://github.com/hueniverse/hawk#single-uri-authorization">Bewit authentication</a> provides a short-term access to a protected resource by
including a token (bewit) in the request query, issued by an authorized party. Bewit is a subset of the Hawk protocol. The scheme can only
be used with 'GET' requests and requires the following options:</p>

<ul>
<li><code>scheme</code> - set to <code>'bewit'</code>.</li>
<li><code>getCredentialsFunc</code> - credential lookup function with the signature <code>function(id, callback)</code> where:

<ul>
<li><code>id</code> - the Hawk credentials identifier.</li>
<li><code>callback</code> - the callback function with signature <code>function(err, credentials)</code> where:

<ul>
<li><code>err</code> - an internal error.</li>
<li><code>credentials</code> - a credentials object passed back to the application in <code>request.auth.credentials</code>. Return <code>null</code> or <code>undefined</code> to
indicate unknown credentials (which is not considered an error state).</li>
</ul></li>
</ul></li>
<li><code>hawk</code> - optional protocol options passed to <code>Hawk.server.authenticateBewit()</code>.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">credentials</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">d74s3nz2873n</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">key</span><span class="o">:</span> <span class="s1">'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn'</span><span class="p">,</span>
        <span class="nx">algorithm</span><span class="o">:</span> <span class="s1">'sha256'</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">getCredentials</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">credentials</span><span class="p">[</span><span class="nx">id</span><span class="p">]);</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">auth</span><span class="p">(</span><span class="s1">'bewit'</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">scheme</span><span class="o">:</span> <span class="s1">'bewit'</span><span class="p">,</span>
    <span class="nx">getCredentialsFunc</span><span class="o">:</span> <span class="nx">getCredentials</span>
<span class="p">});</span>
</code></pre></div>
<p>To send an authenticated Bewit request, the URI must contain the <code>'bewit'</code> query parameter which can be generated using the Hawk module:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hawk</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hawk'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">credentials</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="s1">'d74s3nz2873n'</span><span class="p">,</span>
    <span class="nx">key</span><span class="o">:</span> <span class="s1">'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn'</span><span class="p">,</span>
    <span class="nx">algorithm</span><span class="o">:</span> <span class="s1">'sha256'</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">uri</span> <span class="o">=</span> <span class="s1">'http://example.com:8080/endpoint'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">bewit</span> <span class="o">=</span> <span class="nx">Hawk</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">getBewit</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="p">{</span> <span class="nx">credentials</span><span class="o">:</span> <span class="nx">credentials</span><span class="p">,</span> <span class="nx">ttlSec</span><span class="o">:</span> <span class="mi">60</span> <span class="p">});</span>
<span class="nx">uri</span> <span class="o">+=</span> <span class="s1">'?bewit='</span> <span class="o">+</span> <span class="nx">bewit</span><span class="p">;</span>
</code></pre></div>
<h4 id="server-ext-event--method---options--"><code>server.ext(event, method, [options])</code></h4>

<p>Registers an extension function in one of the available <a href="http://spumko.github.io/resource/api/#request-lifecycle">extension points</a> where:</p>

<ul>
<li><code>event</code> - the event name.</li>
<li><code>method</code> - a function or an array of functions to be executed at a specified point during request processing. The required extension function signature
is <code>function(request, next)</code> where:

<ul>
<li><code>request</code> - the incoming <code>request</code> object.</li>
<li><code>next</code> - the callback function the extension method must call to return control over to the router with signature <code>function(exit)</code> where:

<ul>
<li><code>exit</code> - optional request processing exit response. If set to a non-falsy value, the request lifecycle process will jump to the
"send response" step, skipping all other steps in between, and using the <code>exit</code> value as the new response. <code>exit</code> can be any result
value accepted by <a href="http://spumko.github.io/resource/api/#requestreplyresult"><code>request.reply()</code></a>.</li>
</ul></li>
</ul></li>
<li><code>options</code> - an optional object with the following:

<ul>
<li><code>before</code> - a string or array of strings of plugin names this method must executed before (on the same event). Otherwise, extension methods are executed
in the order added.</li>
<li><code>after</code> - a string or array of strings of plugin names this method must executed before (on the same event). Otherwise, extension methods are executed
in the order added.</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">();</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">ext</span><span class="p">(</span><span class="s1">'onRequest'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Change all requests to '/test'</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">setUrl</span><span class="p">(</span><span class="s1">'/test'</span><span class="p">);</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">({</span> <span class="nx">status</span><span class="o">:</span> <span class="s1">'ok'</span> <span class="p">});</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/test'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">handler</span> <span class="p">});</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>

<span class="c1">// All requests will get routed to '/test'</span>
</code></pre></div>
<h5 id="toc_26">Request lifecycle</h5>

<p>Each incoming request passes through a pre-defined set of steps, along with optional extensions:</p>

<ul>
<li><strong><code>'onRequest'</code></strong> extension point

<ul>
<li>always called</li>
<li>the <code>request</code> object passed to the extension functions is decorated with the <code>request.setUrl(url)</code> and <code>request.setMethod(verb)</code> methods. Calls to these methods
will impact how the request is routed and can be used for rewrite rules.</li>
</ul></li>
<li>Lookup route using request path</li>
<li>Parse cookies</li>
<li><strong><code>'onPreAuth'</code></strong> extension point</li>
<li>Authenticate request</li>
<li>Read and parse payload</li>
<li>Authenticate request payload</li>
<li><strong><code>'onPostAuth'</code></strong> extension point</li>
<li>Validate path parameters</li>
<li>Process query extensions (e.g. JSONP)</li>
<li>Validate query</li>
<li>Validate payload</li>
<li><strong><code>'onPreHandler'</code></strong> extension point</li>
<li>Route prerequisites</li>
<li>Route handler</li>
<li><strong><code>'onPostHandler'</code></strong> extension point

<ul>
<li>the <code>request</code> object passed to the extension function is decorated with the <code>request.response()</code> method which returns the response object. The response object may be
modified. To return a different response (for example, replace an error with an HTML response), return the new response via <code>next(response)</code>.</li>
</ul></li>
<li>Validate response payload</li>
<li><strong><code>'onPreResponse'</code></strong> extension point

<ul>
<li>always called</li>
<li>the <code>request</code> object passed to the extension function is decorated with the <code>request.response()</code> method which returns the response object. The response object may be
modified. To return a different response (for example, replace an error with an HTML response), return the new response via <code>next(response)</code>.</li>
</ul></li>
<li>Send response (may emit <code>'internalError'</code> event)</li>
<li>Emits <code>'response'</code> event</li>
<li>Wait for tails</li>
<li>Emits <code>'tail'</code> event</li>
</ul>

<h4 id="server-helper-name--method---options--"><code>server.helper(name, method, [options])</code></h4>

<p>Registers a server helper function. Server helpers are functions registered with the server and used throughout the application as
a common utility. Their advantage is in the ability to configure them to use the built-in cache and shared across multiple request
handlers without having to create a common module.</p>

<p>Helpers are registered via <code>server.helper(name, method, [options])</code> where:</p>

<ul>
<li><code>name</code> - a unique helper name used to invoke the method via <code>server.helpers[name]</code>.</li>
<li><code>method</code> - the helper function with the signature is <code>function(arg1, arg2, ..., argn, next)</code> where:

<ul>
<li><code>arg1</code>, <code>arg2</code>, etc. - the helper function arguments.</li>
<li><code>next</code> - the function called when the helper is done with the signature <code>function(result)</code> where:

<ul>
<li><code>result</code> - any return value including an <code>Error</code> object (created via <code>new Error()</code> or <a href="http://spumko.github.io/resource/api/#hapierror"><code>Hapi.error</code></a>).</li>
</ul></li>
</ul></li>
<li><code>options</code> - optional configuration:

<ul>
<li><code>cache</code> - cache configuration as described in <a href="https://github.com/spumko/catbox#policy"><strong>catbox</strong> module documentation</a>:

<ul>
<li><code>expiresIn</code> - relative expiration expressed in the number of milliseconds since the item was saved in the cache. Cannot be used
together with <code>expiresAt</code>.</li>
<li><code>expiresAt</code> - time of day expressed in 24h notation using the 'MM:HH' format, at which point all cache records for the route
expire. Cannot be used together with <code>expiresIn</code>.</li>
<li><code>staleIn</code> - number of milliseconds to mark an item stored in cache as stale and reload it. Must be less than <code>expiresIn</code>.</li>
<li><code>staleTimeout</code> - number of milliseconds to wait before checking if an item is stale.</li>
<li><code>segment</code> - optional segment name, used to isolate cached items within the cache partition. Defaults to '#name' where 'name' is the
helper name. When setting segment manually, it must begin with '##'.</li>
</ul></li>
<li><code>generateKey</code> - a function used to generate a unique key (for caching) from the arguments passed to the helper function
(with the exception of the last 'next' argument). The server will automatically generate a unique key if the function's
arguments are all of types <code>'string'</code>, <code>'number'</code>, or <code>'boolean'</code>. However if the helper uses other types of arguments, a
key generation function must be provided which takes the same arguments as the function and returns a unique string (or
<code>null</code> if no key can be generated). Note that when the <code>generateKey</code> method is invoked, the arguments list will include
the <code>next</code> argument which must not be used in calculation of the key.</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">();</span>

<span class="c1">// Simple arguments</span>

<span class="kd">var</span> <span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">next</span><span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">helper</span><span class="p">(</span><span class="s1">'sum'</span><span class="p">,</span> <span class="nx">add</span><span class="p">,</span> <span class="p">{</span> <span class="nx">cache</span><span class="o">:</span> <span class="p">{</span> <span class="nx">expiresIn</span><span class="o">:</span> <span class="mi">2000</span> <span class="p">}</span> <span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">sum</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Object argument</span>

<span class="kd">var</span> <span class="nx">addArray</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">array</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">item</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="nx">next</span><span class="p">(</span><span class="nx">sum</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">helper</span><span class="p">(</span><span class="s1">'sumObj'</span><span class="p">,</span> <span class="nx">addArray</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">cache</span><span class="o">:</span> <span class="p">{</span> <span class="nx">expiresIn</span><span class="o">:</span> <span class="mi">2000</span> <span class="p">},</span>
    <span class="nx">generateKey</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">return</span> <span class="nx">array</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">','</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">sumObj</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="server-inject-options--callback-"><code>server.inject(options, callback)</code></h4>

<p>Injects a request into the server simulating an incoming HTTP request without making an actual socket connection. Injection is useful for
testing purposes as well as for invoking routing logic internally without the overhead or limitations of the network stack. Utilizes the
<a href="https://github.com/spumko/shot"><strong>shot</strong></a> module for performing injections, with some additional options and response properties:</p>

<ul>
<li><code>options</code> - can be assign a string with the requested URI, or an object with:

<ul>
<li><code>method</code> - the request HTTP method (e.g. <code>'POST'</code>). Defaults to <code>'GET'</code>.</li>
<li><code>url</code> - the request URL. If the URI includes an authority (e.g. <code>'example.com:8080'</code>), it is used to automatically set an HTTP 'Host'
header, unless one was specified in <code>headers</code>.</li>
<li><code>headers</code> - an object with optional request headers where each key is the header name and the value is the header content. Defaults
to no additions to the default Shot headers.</li>
<li><code>payload</code> - an optional string or buffer containing the request payload (object must be manually converted to a string first).
Defaults to no payload. Note that payload processing defaults to <code>'application/json'</code> if no 'Content-Type' header provided.</li>
<li><code>credentials</code> - an optional credentials object containing authentication information. The <code>credentials</code> are used to bypass the default
authentication strategies, and are validated directly as if they were received via an authentication scheme. Defaults to no credentials.</li>
<li><code>simulate</code> - an object with options used to simulate client request stream conditions for testing:

<ul>
<li><code>error</code> - if <code>true</code>, emits an <code>'error'</code> event after payload transmission (if any). Defaults to <code>false</code>.</li>
<li><code>close</code> - if <code>true</code>, emits a <code>'close'</code> event after payload transmission (if any). Defaults to <code>false</code>.</li>
<li><code>end</code> - if <code>false</code>, does not end the stream. Defaults to <code>true</code>.</li>
</ul></li>
</ul></li>
<li><code>callback</code> - the callback function with signature <code>function(res)</code> where:

<ul>
<li><code>res</code> - the response object where:

<ul>
<li><code>statusCode</code> - the HTTP status code.</li>
<li><code>headers</code> - an array containing the headers set.</li>
<li><code>payload</code> - the response payload string.</li>
<li><code>rawPayload</code> - the raw response payload buffer.</li>
<li><code>raw</code> - an object with the injection request and response objects:

<ul>
<li><code>req</code> - the <code>request</code> object.</li>
<li><code>res</code> - the response object.</li>
</ul></li>
<li><code>result</code> - the raw handler response (e.g. when not a stream) before it is serialized for transmission. If not available, set to
<code>payload</code>. Useful for inspection and reuse of the internal objects returned (instead of parsing the response string).</li>
</ul></li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s1">'Success!'</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">get</span> <span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">inject</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">result</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<h3 id="server-events"><code>Server</code> events</h3>

<p>The server object inherits from <code>Events.EventEmitter</code> and emits the following events:</p>

<ul>
<li><code>'log'</code> - events logged with <a href="http://spumko.github.io/resource/api/#serverlogtags-data-timestamp">server.log()</a>.</li>
<li><code>'request'</code> - events generated by <a href="http://spumko.github.io/resource/api/#requestlogtags-data-timestamp">request.log()</a> or internally (multiple events per request).</li>
<li><code>'response'</code> - emitted after a response to a client request is sent back. Single event per request.</li>
<li><code>'tail'</code> - emitted when a request finished processing, including any registered <a href="http://spumko.github.io/resource/api/#requesttailname">tails</a>. Single event per request.</li>
<li><code>'internalError'</code> - emitted whenever an Internal Server Error (500) error response is sent. Single event per request.</li>
</ul>

<p>When provided (as listed below) the <code>event</code> object include:</p>

<ul>
<li><code>timestamp</code> - the event timestamp.</li>
<li><code>id</code> - if the event relates to a request, the request id.</li>
<li><code>tags</code> - an array of tags (e.g. <code>['error', 'http']</code>). Includes the <code>'hapi'</code> tag is the event was generated internally.</li>
<li><code>data</code> - optional event-specific information.</li>
</ul>

<p>The <code>'log'</code> event includes the <code>event</code> object and a <code>tags</code> object (where each tag is a key with the value <code>true</code>):</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'log'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">tags</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">tags</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Server error: '</span> <span class="o">+</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span> <span class="o">||</span> <span class="s1">'unspecified'</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>The <code>'request'</code> event includes the <code>request</code> object, the <code>event</code> object, and a <code>tags</code> object (where each tag is a key with the value <code>true</code>):</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'request'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">tags</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">tags</span><span class="p">.</span><span class="nx">received</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'New request: '</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>The <code>'response'</code> and <code>'tail'</code> events include the <code>request</code> object:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'response'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Response sent for request: '</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>The <code>'internalError'</code> event includes the <code>request</code> object and the causing error <code>err</code> object:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'internalError'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Error response (500) sent for request: '</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">' because: '</span> <span class="o">+</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<h2 id="request-object">Request object</h2>

<p>The <code>request</code> object is created internally for each incoming request. It is <strong>not</strong> the node <code>request</code> object received from the HTTP
server callback (which is available in <code>request.raw.req</code>). The <code>request</code> object methods and properties change through the
<a href="http://spumko.github.io/resource/api/#request-lifecycle">request lifecycle</a>.</p>

<h3 id="request-properties"><code>request</code> properties</h3>

<p>Each request object have the following properties:</p>

<ul>
<li><code>app</code> - application-specific state. Provides a safe place to store application data without potential conflicts with <strong>hapi</strong>.
Should not be used by plugins which should use <code>plugins[name]</code>.</li>
<li><code>auth</code> - authentication information:

<ul>
<li><code>isAuthenticated</code> - <code>true</code> is the request has been successfully authenticated, otherwise <code>false</code>.</li>
<li><code>credentials</code> - the <code>credential</code> object received during the authentication process. The presence of an object does not mean
successful authentication.</li>
<li><code>artifacts</code> - an artifact object received from the authentication strategy and used in authentication-related actions.</li>
<li><code>session</code> - an object used by the <a href="http://spumko.github.io/resource/api/#cookie-authentication"><code>'cookie'</code> authentication scheme</a>.</li>
</ul></li>
<li><code>id</code> - a unique request identifier.</li>
<li><code>info</code> - request information:

<ul>
<li><code>received</code> - request reception timestamp.</li>
<li><code>remoteAddress</code> - remote client IP address.</li>
<li><code>remotePort</code> - remote client port.</li>
<li><code>referrer</code> - content of the HTTP 'Referrer' (or 'Referer') header.</li>
<li><code>host</code> - content of the HTTP 'Host' header.</li>
</ul></li>
<li><code>method</code> - the request method in lower case (e.g. <code>'get'</code>, <code>'post'</code>).</li>
<li><code>params</code> - an object where each key is a path parameter name with matching value as described in <a href="http://spumko.github.io/resource/api/#path-parameters">Path parameters</a>.</li>
<li><code>path</code> - the request URI's path component.</li>
<li><code>payload</code> - an object containing the parsed request payload (when the route <code>payload</code> option is set to <code>'parse'</code>).</li>
<li><code>plugins</code> - plugin-specific state. Provides a place to store and pass request-level plugin data. The <code>plugins</code> is an object where each
key is a plugin name and the value is the state.</li>
<li><code>pre</code> - an object where each key is the name assigned by a <a href="http://spumko.github.io/resource/api/#route-prerequisites">route prerequisites</a> function.</li>
<li><code>query</code> - an object containing the query parameters.</li>
<li><code>raw</code> - an object containing the Node HTTP server objects. <strong>Direct interaction with these raw objects is not recommended.</strong>

<ul>
<li><code>req</code> - the <code>request</code> object.</li>
<li><code>res</code> - the response object.</li>
</ul></li>
<li><code>rawPayload</code> - the raw request payload <code>Buffer</code> (except when the route <code>payload</code> option is set to <code>'stream'</code>).</li>
<li><code>route</code> - the route configuration object after defaults are applied.</li>
<li><code>server</code> - the server object.</li>
<li><code>session</code> - Special key reserved for plugins implementing session support. Plugins utilizing this key must check for <code>null</code> value
to ensure there is no conflict with another similar plugin.</li>
<li><code>state</code> - an object containing parsed HTTP state information (cookies) where each key is the cookie name and value is the matching
cookie content after processing using any registered cookie definition.</li>
<li><code>url</code> - the parsed request URI.</li>
</ul>

<h3 id="request-methods"><code>request</code> methods</h3>

<h4 id="request-seturl-url-"><code>request.setUrl(url)</code></h4>

<p><em>Available only in <code>'onRequest'</code> extension methods.</em></p>

<p>Changes the request URI before the router begins processing the request where:</p>

<ul>
<li><code>url</code> - the new request path value.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">();</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">ext</span><span class="p">(</span><span class="s1">'onRequest'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Change all requests to '/test'</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">setUrl</span><span class="p">(</span><span class="s1">'/test'</span><span class="p">);</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="request-setmethod-method-"><code>request.setMethod(method)</code></h4>

<p><em>Available only in <code>'onRequest'</code> extension methods.</em></p>

<p>Changes the request method before the router begins processing the request where:</p>

<ul>
<li><code>method</code> - is the request HTTP method (e.g. <code>'GET'</code>).</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">();</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">ext</span><span class="p">(</span><span class="s1">'onRequest'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Change all requests to 'GET'</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">setMethod</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">);</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="request-log-tags---data---timestamp---"><code>request.log(tags, [data, [timestamp]])</code></h4>

<p><em>Always available.</em></p>

<p>Logs request-specific events. When called, the server emits a <code>'request'</code> event which can be used by other listeners or plugins. The
arguments are:</p>

<ul>
<li><code>tags</code> - a string or an array of strings (e.g. <code>['error', 'database', 'read']</code>) used to identify the event. Tags are used instead of log levels
and provide a much more expressive mechanism for describing and filtering events. Any logs generated by the server internally include the <code>'hapi'</code>
tag along with event-specific information.</li>
<li><code>data</code> - an optional message string or object with the application data being logged.</li>
<li><code>timestamp</code> - an optional timestamp expressed in milliseconds. Defaults to <code>Date.now()</code> (now).</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">();</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'request'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">tags</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">tags</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">([</span><span class="s1">'test'</span><span class="p">,</span> <span class="s1">'error'</span><span class="p">],</span> <span class="s1">'Test event'</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="request-getlog--tags--"><code>request.getLog([tags])</code></h4>

<p><em>Always available.</em></p>

<p>Returns an array containing the events matching any of the tags specified (logical OR) where:
- <code>tags</code> - is a single tag string or array of tag strings. If no <code>tags</code> specified, returns all events.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">request</span><span class="p">.</span><span class="nx">getLog</span><span class="p">();</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">getLog</span><span class="p">(</span><span class="s1">'error'</span><span class="p">);</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">getLog</span><span class="p">([</span><span class="s1">'hapi'</span><span class="p">,</span> <span class="s1">'error'</span><span class="p">]);</span>
</code></pre></div>
<h4 id="request-tail--name--"><code>request.tail([name])</code></h4>

<p><em>Available until immediately after the <code>'response'</code> event is emitted.</em></p>

<p>Adds a request tail which has to complete before the request lifecycle is complete where:</p>

<ul>
<li><code>name</code> - an optional tail name used for logging purposes.</li>
</ul>

<p>Returns a tail function which must be called when the tail activity is completed.</p>

<p>Tails are actions performed throughout the request lifecycle, but which may end after a response is sent back to the client. For example, a
request may trigger a database update which should not delay sending back a response. However, it is still desirable to associate the activity
with the request when logging it (or an error associated with it).</p>

<p>When all tails completed, the server emits a <code>'tail'</code> event.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">dbTail</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">tail</span><span class="p">(</span><span class="s1">'write to database'</span><span class="p">);</span>

    <span class="nx">db</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="s1">'key'</span><span class="p">,</span> <span class="s1">'value'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

        <span class="nx">dbTail</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">request</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s1">'Success!'</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">get</span> <span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'tail'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Request completed including db activity'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="request-setstate-name--value---options--"><code>request.setState(name, value, [options])</code></h4>

<p><em>Available until immediately after the <code>'onPreResponse'</code> extension point methods are called.</em></p>

<p>Sets a cookie which is sent with the response, where:</p>

<ul>
<li><code>name</code> - the cookie name.</li>
<li><code>value</code> - the cookie value. If no <code>encoding</code> is defined, must be a string.</li>
<li><code>options</code> - optional configuration. If the state was previously registered with the server using <a href="http://spumko.github.io/resource/api/#serverstatename-options"><code>server.state()</code></a>,
the specified keys in <code>options</code> override those same keys in the server definition (but not others).</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">request</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="s1">'preferences'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">color</span><span class="o">:</span> <span class="s1">'blue'</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">encoding</span><span class="o">:</span> <span class="s1">'base64json'</span> <span class="p">});</span>
</code></pre></div>
<h4 id="request-clearstate-name-"><code>request.clearState(name)</code></h4>

<p><em>Available until immediately after the <code>'onPreResponse'</code> extension point methods are called.</em></p>

<p>Clears a cookie which sets an expired cookie and sent with the response, where:</p>

<ul>
<li><code>name</code> - the cookie name.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">request</span><span class="p">.</span><span class="nx">clearState</span><span class="p">(</span><span class="s1">'preferences'</span><span class="p">);</span>
</code></pre></div>
<h4 id="request-reply--result--"><code>request.reply([result])</code></h4>

<p><em>Available only within the handler method and only before one of <code>request.reply()</code>, <code>request.reply.redirection()</code>, <code>request.reply.view()</code>, or
<code>request.reply.close()</code> is called.</em></p>

<p>Concludes the handler activity by returning control over to the router where:</p>

<ul>
<li><code>result</code> - an optional response payload.</li>
</ul>

<p>Returns a <a href="http://spumko.github.io/resource/api/#response-types"><code>response</code></a> object based on the value of <code>result</code>:</p>

<ul>
<li><code>null</code>, <code>undefined</code>, or empty string <code>''</code> - <a href="http://spumko.github.io/resource/api/#empty"><code>Empty</code></a> response.</li>
<li>string - <a href="http://spumko.github.io/resource/api/#text"><code>Text</code></a> response.</li>
<li><code>Buffer</code> object - <a href="http://spumko.github.io/resource/api/#buffer"><code>Buffer</code></a> response.</li>
<li><code>Error</code> object (generated via <a href="http://spumko.github.io/resource/api/#hapierror"><code>error</code></a> or <code>new Error()</code>) - <a href="http://spumko.github.io/resource/api/#hapierror"><code>Boom</code></a> object.</li>
<li><code>Stream</code> object - <a href="http://spumko.github.io/resource/api/#stream"><code>Stream</code></a> response.</li>
<li>any other object - <a href="http://spumko.github.io/resource/api/#obj"><code>Obj</code></a> response.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s1">'success'</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<p>The returned <code>response</code> object provides a set of methods to customize the response (e.g. HTTP status code, custom headers, etc.). The methods
are response-type-specific and listed in <a href="http://spumko.github.io/resource/api/#response-types"><code>response</code></a>.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s1">'success'</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="s1">'text/plain)</span>
<span class="s1">        .header('</span><span class="nx">X</span><span class="o">-</span><span class="nx">Custom</span><span class="s1">', '</span><span class="nx">some</span><span class="o">-</span><span class="nx">value</span><span class="err">'</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<p>The <a href="http://spumko.github.io/resource/api/#flow-control">response flow control rules</a> apply.</p>

<h5 id="toc_41"><code>request.reply.redirect(uri)</code></h5>

<p><em>Available only within the handler method and only before one of <code>request.reply()</code>, <code>request.reply.redirection()</code>, <code>request.reply.view()</code>, or
<code>request.reply.close()</code> is called.</em></p>

<p>Concludes the handler activity by returning control over to the router with a redirection response where:</p>

<ul>
<li><code>uri</code> - an absolute or relative URI used to redirect the client to another resource. If a relative URI is provided, the value of
the server <a href="http://spumko.github.io/resource/api/#server.config.location"><code>location</code></a> configuration option is used as prefix.</li>
</ul>

<p>Returns a <a href="http://spumko.github.io/resource/api/#redirection"><code>Redirection</code></a> response.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">.</span><span class="nx">redirection</span><span class="p">(</span><span class="s1">'http://example.com/elsewhere'</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="s1">'You are being redirected...'</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">permanent</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<p>The <a href="http://spumko.github.io/resource/api/#flow-control">response flow control rules</a> apply.</p>

<h5 id="toc_42"><code>request.reply.view(template, [context, [options]])</code></h5>

<p><em>Available only within the handler method and only before one of <code>request.reply()</code>, <code>request.reply.redirection()</code>, <code>request.reply.view()</code>, or
<code>request.reply.close()</code> is called.</em></p>

<p>Concludes the handler activity by returning control over to the router with a templatized view response where:</p>

<ul>
<li><code>template</code> - the template filename and path, relative to the templates path configured via the server <a href="http://spumko.github.io/resource/api/#server.config.views"><code>views.path</code></a>.</li>
<li><code>context</code> - optional object used by the template to render context-specific result. Defaults to no context <code>{}</code>.</li>
<li><code>options</code> - optional object used to override the server's <a href="http://spumko.github.io/resource/api/#server.config.views"><code>views</code></a> configuration for this response.</li>
</ul>

<p>Returns a <a href="http://spumko.github.io/resource/api/#view"><code>View</code></a> response.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">({</span>
    <span class="nx">views</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">engines</span><span class="o">:</span> <span class="p">{</span> <span class="nx">html</span><span class="o">:</span> <span class="s1">'handlebars'</span> <span class="p">},</span>
        <span class="nx">path</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">'/templates'</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">title</span><span class="o">:</span> <span class="s1">'Views Example'</span><span class="p">,</span>
        <span class="nx">message</span><span class="o">:</span> <span class="s1">'Hello, World'</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">.</span><span class="nx">view</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">http</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">handler</span> <span class="p">});</span>
</code></pre></div>
<p><strong>templates/hello.html</strong></p>
<div class="highlight"><pre><code class="html language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="nt">&lt;h1&gt;&lt;/h1&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
<p>The <a href="http://spumko.github.io/resource/api/#flow-control">response flow control rules</a> apply.</p>

<h5 id="toc_43"><code>request.reply.close()</code></h5>

<p><em>Available only within the handler method and only before one of <code>request.reply()</code>, <code>request.reply.redirection()</code>, <code>request.reply.view()</code>, or
<code>request.reply.close()</code> is called.</em></p>

<p>Concludes the handler activity by returning control over to the router and informing the router that a response has already been sent back
directly via <code>request.raw.res</code> and that no further response action is needed (the router will ensure the <code>request.raw.res</code> was ended).</p>

<p>No return value.</p>

<p>The <a href="http://spumko.github.io/resource/api/#flow-control">response flow control rules</a> <strong>do not</strong> apply.</p>

<h4 id="request-generateview-template--context---options--"><code>request.generateView(template, context, [options])</code></h4>

<p><em>Always available.</em></p>

<p>Returns a <a href="http://spumko.github.io/resource/api/#view"><code>View</code></a> response object using the request environment where:</p>

<ul>
<li><code>template</code> - the template filename and path, relative to the templates path configured via the server <a href="http://spumko.github.io/resource/api/#server.config.views"><code>views.path</code></a>.</li>
<li><code>context</code> - optional object used by the template to render context-specific result. Defaults to no context <code>{}</code>.</li>
<li><code>options</code> - optional object used to override the server's <a href="http://spumko.github.io/resource/api/#server.config.views"><code>views</code></a> configuration for this response.</li>
</ul>

<p>Useful when a view response is required outside of the handler (e.g. used in an extension point method to return an override response).</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">({</span> <span class="nx">views</span><span class="o">:</span> <span class="p">{</span> <span class="nx">engines</span><span class="o">:</span> <span class="p">{</span> <span class="nx">html</span><span class="o">:</span> <span class="s1">'handlebars'</span> <span class="p">}</span> <span class="p">}</span> <span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">ext</span><span class="p">(</span><span class="s1">'onPreResponse'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">response</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">isBoom</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Replace error with friendly HTML</span>

      <span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="nx">response</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">message</span><span class="o">:</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">code</span> <span class="o">===</span> <span class="mi">404</span> <span class="o">?</span> <span class="s1">'page not found'</span> <span class="o">:</span> <span class="s1">'something went wrong'</span><span class="p">)</span>
      <span class="p">};</span>

      <span class="nx">next</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">generateView</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="nx">context</span><span class="p">));</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="request-response--"><code>request.response()</code></h4>

<p><em>Available after the handler method concludes and immediately after the <code>'onPreResponse'</code> extension point methods.</em></p>

<p>Returns the response object. The object can be modified but cannot be assigned another object. To replace the response with another
from within an extension point, use <code>next(response)</code> to return a different response.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">();</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">ext</span><span class="p">(</span><span class="s1">'onPostHandler'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">response</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">variety</span> <span class="o">===</span> <span class="s1">'obj'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">delete</span> <span class="nx">response</span><span class="p">.</span><span class="nx">raw</span><span class="p">.</span><span class="nx">_id</span><span class="p">;</span>        <span class="c1">// Remove internal key</span>
        <span class="nx">response</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>
<h2 id="hapi-response"><code>Hapi.response</code></h2>

<h3 id="flow-control">Flow control</h3>

<p>When calling <code>request.reply()</code>, the router waits until <code>process.nextTick()</code> to continue processing the request and transmit the response.
This enables making changes to the returned response object before the response is sent. This means the router will resume as soon as the handler
method exists. To suspend this behavior, the returned <code>response</code> object includes:</p>

<ul>
<li><code>response.hold()</code> - puts the response on hold until <code>response.send()</code> is called. Available only after <code>request.reply()</code> is called and until
<code>response.hold()</code> is invoked once.</li>
<li><code>response.send()</code> - resume the response which will be transmitted in the next tick. Available only after <code>response.hold()</code> is called and until
<code>response.send()</code> is invoked once.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s1">'success'</span><span class="p">).</span><span class="nx">hold</span><span class="p">();</span>

    <span class="nx">onTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

        <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
    <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="response-types">Response types</h3>

<p>Every response type must include the following properties:</p>

<ul>
<li><code>variety</code> - the response type name in lower case (e.g. <code>'text'</code>).</li>
<li><code>varieties</code> - an object where each key has a <code>true</code> value and represents a response type name (in lower case) whose functionality is made
available via the response object (e.g. the <code>File</code> response type <code>varieties</code> object is <code>{ generic: true, stream: true, file: true }</code>).</li>
</ul>

<h4 id="generic"><code>Generic</code></h4>

<p>The <code>Generic</code> response type is used as the parent prototype for all other response types. It cannot be instantiated directly and is only made available
for deriving other response types. It provides the following methods:</p>

<ul>
<li><code>code(statusCode)</code> - sets the HTTP status code where:

<ul>
<li><code>statusCode</code> - the HTTP status code.</li>
</ul></li>
<li><code>header(name, value)</code> - sets an HTTP header where:

<ul>
<li><code>name</code> - the header name.</li>
<li><code>value</code> - the header value.</li>
</ul></li>
<li><code>type(mimeType)</code> - sets the HTTP 'Content-Type' header where:

<ul>
<li><code>value</code> - is the mime type. Should only be used to override the built-in default for each response type.</li>
</ul></li>
<li><code>created(location)</code> - sets the HTTP status code to Created (201) and the HTTP 'Location' header where:
<code>location</code> - an absolute or relative URI used as the 'Location' header value. If a relative URI is provided, the value of
  the server <a href="http://spumko.github.io/resource/api/#server.config.location"><code>location</code></a> configuration option is used as prefix. Not available in the <code>Redirection</code>
  response object.</li>
<li><code>encoding(encoding)</code> - sets the 'Content-Type' HTTP header encoding property where:
<code>encoding</code> - the encoding property value.</li>
<li><code>ttl(msec)</code> - overrides the default route cache expiration rule for this response instance where:

<ul>
<li><code>msec</code> - the time-to-live value in milliseconds.</li>
</ul></li>
<li><code>getTtl()</code> - returns the time-to-live value if an override has been set, and the request method is 'GET'.</li>
<li><code>state(name, value, [options])</code> - sets an HTTP cookie as described in <a href="http://spumko.github.io/resource/api/#requestsetstatename-value-options"><code>request.setState()</code></a>.</li>
<li><code>unstate(name)</code> - clears the HTTP cookie by setting an expired value as described in <a href="http://spumko.github.io/resource/api/#requestclearstatename"><code>request.clearState()</code></a>.</li>
</ul>

<h4 id="empty"><code>Empty</code></h4>

<p>An empty response body (content-length of zero bytes). Supports all the methods provided by <a href="http://spumko.github.io/resource/api/#generic"><code>Generic</code></a>.</p>

<p>Generated with:</p>

<ul>
<li><code>request.reply()</code> - without any arguments.</li>
<li><code>new Hapi.response.Empty()</code></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">handler1</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">();</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">handler2</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">Empty</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="text"><code>Text</code></h4>

<p>Plain text. The 'Content-Type' header defaults to <code>'text/html'</code>. Supports all the methods provided by <a href="http://spumko.github.io/resource/api/#generic"><code>Generic</code></a> as well as:</p>

<ul>
<li><code>message(text, [type, [encoding]])</code> - sets or replace the response text where:

<ul>
<li><code>text</code> - the text content.</li>
<li><code>type</code> - the 'Content-Type' HTTP header value. Defaults to <code>'text/html'</code>.</li>
<li><code>encoding</code> - the 'Content-Type' HTTP header encoding property. Defaults to <code>'utf-8'</code>.</li>
</ul></li>
</ul>

<p>Generated with:</p>

<ul>
<li><code>request.reply(result)</code> - where:

<ul>
<li><code>result</code> - must be a non-empty string.</li>
</ul></li>
<li><code>new Hapi.response.Text(text, [type, [encoding]])</code> - same as <code>message()</code> above.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">handler1</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s1">'hello world'</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">handler2</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">Text</span><span class="p">(</span><span class="s1">'hello world'</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">handler3</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">Text</span><span class="p">();</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="s1">'hello world'</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="buffer"><code>Buffer</code></h4>

<p>Buffer response. Supports all the methods provided by <a href="http://spumko.github.io/resource/api/#generic"><code>Generic</code></a>.</p>

<p>Generated with:</p>

<ul>
<li><code>request.reply(result)</code> - where:

<ul>
<li><code>result</code> - must be a <code>Buffer</code>.</li>
</ul></li>
<li><code>new Hapi.response.Buffer(buffer)</code> - where:

<ul>
<li><code>buffer</code> - the <code>Buffer</code> response.</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">handler1</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">]);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">buffer</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">handler2</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">]);</span>
    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">Buffer</span><span class="p">(</span><span class="nx">buffer</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="stream"><code>Stream</code></h4>

<p>Replies with a stream object, directly piped into the HTTP response. Supports all the methods provided by <a href="http://spumko.github.io/resource/api/#generic"><code>Generic</code></a> as well as:</p>

<ul>
<li><code>bytes(length)</code> - sets the HTTP 'Content-Length' header (to avoid chunked transfer encoding) where:

<ul>
<li><code>length</code> - the header value. Must match the actual payload size.</li>
</ul></li>
</ul>

<p>Generated with:</p>

<ul>
<li><code>request.reply(result)</code> - where:

<ul>
<li><code>result</code> - must be a <a href="http://nodejs.org/api/stream.html#stream_class_stream_readable"><code>Stream.Readable</code></a> or a node 0.8.x <code>Stream</code>.</li>
</ul></li>
<li><code>new Hapi.response.Stream(stream)</code> - where:

<ul>
<li><code>stream</code> - the <a href="http://nodejs.org/api/stream.html#stream_class_stream_readable"><code>Stream.Readable</code></a> or a node 0.8.x <code>Stream</code>.</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Stream</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'stream'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">ExampleStream</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="nx">Stream</span><span class="p">.</span><span class="nx">Readable</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">Hapi</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">inherits</span><span class="p">(</span><span class="nx">ExampleStream</span><span class="p">,</span> <span class="nx">Stream</span><span class="p">.</span><span class="nx">Readable</span><span class="p">);</span>

<span class="nx">ExampleStream</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_read</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">size</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">'hello world'</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">handler1</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">stream</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ExampleStream</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">stream</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">handler2</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">Stream</span><span class="p">(</span><span class="k">new</span> <span class="nx">ExampleStream</span><span class="p">());</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">handler3</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="c1">// Echo back request stream</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">raw</span><span class="p">.</span><span class="nx">req</span><span class="p">).</span><span class="nx">bytes</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">raw</span><span class="p">.</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">'content-length'</span><span class="p">]);</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="obj"><code>Obj</code></h4>

<p>JavaScript object, sent stringified. The 'Content-Type' header defaults to 'application/json'. Supports all the methods provided by
<a href="http://spumko.github.io/resource/api/#generic"><code>Generic</code></a> as well as:</p>

<ul>
<li><code>raw</code> - the unmodified, unstringified object. Any direct manipulation must be followed with <code>update()</code>.</li>
<li><code>update(type, encoding)</code> - updates the string representation of the object response after changes to <code>raw</code> where:

<ul>
<li><code>type</code> - the 'Content-Type' HTTP header value. Defaults to <code>'text/html'</code>.</li>
<li><code>encoding</code> - the 'Content-Type' HTTP header encoding property. Defaults to <code>'utf-8'</code>.</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">();</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">ext</span><span class="p">(</span><span class="s1">'onPostHandler'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">response</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">variety</span> <span class="o">===</span> <span class="s1">'obj'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">delete</span> <span class="nx">response</span><span class="p">.</span><span class="nx">raw</span><span class="p">.</span><span class="nx">_id</span><span class="p">;</span>        <span class="c1">// Remove internal key</span>
        <span class="nx">response</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>
<p>Generated with:</p>

<ul>
<li><code>request.reply(result)</code> - where:

<ul>
<li><code>result</code> - must be an object.</li>
</ul></li>
<li><code>new Hapi.response.Obj(object, [type, [encoding]])</code> - where:

<ul>
<li><code>object</code> - the response object.</li>
<li><code>type</code> - the 'Content-Type' HTTP header value. Defaults to <code>'text/html'</code>.</li>
<li><code>encoding</code> - the 'Content-Type' HTTP header encoding property. Defaults to <code>'utf-8'</code>.</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">handler1</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s1">'hello world'</span> <span class="p">});</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">handler2</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">Obj</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s1">'hello world'</span> <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="file"><code>File</code></h4>

<p>Transmits a file from the file system. The 'Content-Type' header defaults to the matching mime type based on filename extension. Supports all the methods
provided by <a href="http://spumko.github.io/resource/api/#stream"><code>Stream</code></a>.</p>

<p>Generated with:</p>

<ul>
<li><code>new Hapi.response.File(filePath, [options])</code> - where:

<ul>
<li><code>filePath</code> - a relative or absolute file path string (relative paths are resolved based on the server <a href="http://spumko.github.io/resource/api/#server.config.files"><code>files</code></a> configuration).</li>
<li><code>options</code> - optional configuration:

<ul>
<li><code>mode</code> - value of the HTTP 'Content-Disposition' header. Allowed values:

<ul>
<li><code>'attachment'</code></li>
<li><code>'inline'</code></li>
</ul></li>
</ul></li>
</ul></li>
<li>the built-in route <a href="http://spumko.github.io/resource/api/#route.config.file"><code>file</code></a> handler.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">({</span> <span class="nx">files</span><span class="o">:</span> <span class="p">{</span> <span class="nx">relativeTo</span><span class="o">:</span> <span class="s1">'routes'</span> <span class="p">}</span> <span class="p">});</span>

<span class="kd">var</span> <span class="nx">handler1</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">File</span><span class="p">(</span><span class="s1">'./hello.txt'</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/1'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">handler1</span> <span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/2'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="p">{</span> <span class="nx">file</span><span class="o">:</span> <span class="s1">'./hello.txt'</span> <span class="p">}</span> <span class="p">});</span>
</code></pre></div>
<h4 id="directory"><code>Directory</code></h4>

<p>Transmits a file or list of files from the file system. The 'Content-Type' header defaults to the matching mime type based on filename
extension. This is an internal response time that can only be accessed via the built-in route handler.</p>

<p>Generated with:</p>

<ul>
<li>the built-in route <a href="http://spumko.github.io/resource/api/#route.config.directory"><code>directory</code></a> handler.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">({</span> <span class="nx">files</span><span class="o">:</span> <span class="p">{</span> <span class="nx">relativeTo</span><span class="o">:</span> <span class="s1">'cwd'</span> <span class="p">}</span> <span class="p">});</span>

<span class="kd">var</span> <span class="nx">handler1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">directory</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">path</span><span class="o">:</span> <span class="p">[</span><span class="s1">'./public1/'</span><span class="p">,</span> <span class="s1">'./public2/'</span><span class="p">],</span>
        <span class="nx">listing</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">handler2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">directory</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">path</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>

            <span class="k">return</span> <span class="p">(</span><span class="nx">isMobileDevice</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="o">?</span> <span class="s1">'./mobile'</span> <span class="o">:</span> <span class="s1">'./public'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">http</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/1/{path*}'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">handler1</span> <span class="p">});</span>
<span class="nx">http</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/2/{path*}'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">handler2</span> <span class="p">});</span>
</code></pre></div>
<h4 id="redirection"><code>Redirection</code></h4>

<p>An HTTP redirection response (3xx). Supports all the methods provided by <a href="http://spumko.github.io/resource/api/#text"><code>Text</code></a> (except for <code>created()</code>) as well as the additional methods:</p>

<ul>
<li><code>uri(dest)</code> - set the destination URI where:

<ul>
<li><code>uri</code> - overrides the destination. An absolute or relative URI used as the 'Location' header value. If a relative URI is provided, the
value of the server <a href="http://spumko.github.io/resource/api/#server.config.location"><code>location</code></a> configuration option is used as prefix.</li>
</ul></li>
<li><code>temporary(isTemporary)</code> - sets the status code to <code>302</code> or <code>307</code> (based on the <code>rewritable()</code> setting) where:

<ul>
<li><code>isTemporary</code> - if <code>false</code>, sets status to permanent. Defaults to <code>true</code>.</li>
</ul></li>
<li><code>permanent(isPermanent)</code> - sets the status code to <code>301</code> or <code>308</code> (based on the <code>rewritable()</code> setting) where:

<ul>
<li><code>isPermanent</code> - if <code>true</code>, sets status to temporary. Defaults to <code>false</code>.</li>
</ul></li>
<li><code>rewritable(isRewritable)</code> - sets the status code to <code>301</code>/<code>302</code> for rewritable (allows changing the request method from 'POST' to 'GET') or
<code>307</code>/<code>308</code> for non-rewritable (does not allow changing the request method from 'POST' to 'GET'). Exact code based on the <code>temporary()</code> or
<code>permanent()</code> setting. Arguments:

<ul>
<li><code>isRewritable</code> - if <code>false</code>, sets to non-rewritable. Defaults to <code>true</code>.</li>
</ul></li>
</ul>

<table><thead>
<tr>
<th></th>
<th>Permanent</th>
<th>Temporary</th>
</tr>
</thead><tbody>
<tr>
<td>Rewritable</td>
<td>301</td>
<td><strong>302</strong>(1)</td>
</tr>
<tr>
<td>Non-rewritable</td>
<td>308(2)</td>
<td>307</td>
</tr>
</tbody></table>

<p>Notes:
1. Default value.
2. <a href="http://tools.ietf.org/id/draft-reschke-http-status-308-07.txt">Proposed code</a>, not supported by all clients.</p>

<p>Generated with:</p>

<ul>
<li><code>request.reply.redirect(uri)</code> - as described in <a href="http://spumko.github.io/resource/api/#requestreplyredirecturi"><code>request.reply.redirect()</code></a>.</li>
<li><code>new Hapi.response.Redirection(uri, [message, [type, [encoding]]])</code> - where:

<ul>
<li><code>uri</code> - an absolute or relative URI used as the 'Location' header value. If a relative URI is provided, the value of
the server <a href="http://spumko.github.io/resource/api/#server.config.location"><code>location</code></a> configuration option is used as prefix.</li>
<li><code>message</code> - the payload content. Defaults to <code>'You are being redirected...'</code>.</li>
<li><code>type</code> - the 'Content-Type' HTTP header value. Defaults to <code>'text/html'</code>.</li>
<li><code>encoding</code> - the 'Content-Type' HTTP header encoding property. Defaults to <code>'utf-8'</code>.</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">handler1</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">'http://example.com/elsewhere'</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">temporary</span><span class="p">().</span><span class="nx">rewritable</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>   <span class="c1">// 307</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">handler2</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">Redirection</span><span class="p">(</span><span class="s1">'http://example.com/elsewhere'</span><span class="p">);</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">permanent</span><span class="p">().</span><span class="nx">rewritable</span><span class="p">();</span>          <span class="c1">// 301</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="view"><code>View</code></h4>

<p>Template-based response. Supports all the methods provided by <a href="http://spumko.github.io/resource/api/#generic"><code>Generic</code></a>.</p>

<p>Generated with:</p>

<ul>
<li><code>request.reply.view(template, [context, [options]])</code> - as described in <a href="http://spumko.github.io/resource/api/#requestreplyviewtemplate-context-options"><code>request.reply.view()</code></a>.</li>
<li><code>request.generateView(template, context, [options])</code> - as described in <a href="http://spumko.github.io/resource/api/#requestgenerateviewtemplate-context-options"><code>request.generateView()</code></a>.</li>
<li>the built-in route <a href="http://spumko.github.io/resource/api/#route.config.view"><code>view</code></a> handler.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">({</span>
    <span class="nx">views</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">engines</span><span class="o">:</span> <span class="p">{</span> <span class="nx">html</span><span class="o">:</span> <span class="s1">'handlebars'</span> <span class="p">},</span>
        <span class="nx">path</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">'/templates'</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">handler1</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">params</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">user</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">user</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">.</span><span class="nx">view</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">handler2</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">params</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">user</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">user</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">generateView</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">,</span> <span class="nx">context</span><span class="p">));</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/1/{user}'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">handler1</span> <span class="p">});</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/2/{user}'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">handler2</span> <span class="p">});</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/3/{user}'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="p">{</span> <span class="nx">view</span><span class="o">:</span> <span class="s1">'hello'</span> <span class="p">}</span> <span class="p">});</span>
</code></pre></div>
<p><strong>templates/hello.html</strong></p>
<div class="highlight"><pre><code class="html language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>Hello World<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="nt">&lt;h1&gt;</span>About <span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
<h4 id="cacheable"><code>Cacheable</code></h4>

<p>The <code>Cacheable</code> response type is used as the parent prototype for all cacheable response types. It cannot be instantiated directly and
is only made available for deriving other response types.</p>

<h2 id="hapi-error"><code>Hapi.error</code></h2>

<p>Provides a set of utilities for returning HTTP errors. An alias of the <a href="https://github.com/spumko/boom"><strong>boom</strong></a> module (can be also accessed
<code>Hapi.boom</code>). Each utility returns a <code>Boom</code> error response object (instance of <code>Error</code>) which includes the following properties:</p>

<ul>
<li><code>isBoom</code> - if <code>true</code>, indicates this is a <code>Boom</code> object instance.</li>
<li><code>message</code> - the error message.</li>
<li><code>response</code> - the formatted response. Can be directly manipulated after object construction to return a custom error response. Allowed root keys:

<ul>
<li><code>code</code> - the HTTP status code (typically 4xx or 5xx).</li>
<li><code>headers</code> - an object containing any HTTP headers where each key is a header name and value is the header content.</li>
<li><code>type</code> - a mime-type used as the content of the HTTP 'Content-Type' header (overrides <code>headers['Content-Type']</code> if present in both).</li>
<li><code>payload</code> - the formatted object used as the response payload (stringified). Can be directly manipulated but any changes will be lost
if <code>reformat()</code> is called. Any content allowed and by default includes the following content:

<ul>
<li><code>code</code> - the HTTP status code, derived from <code>error.response.code</code>.</li>
<li><code>error</code> - the HTTP status message (e.g. 'Bad Request', 'Internal Server Error') derived from <code>code</code>.</li>
<li><code>message</code> - the error message derived from <code>error.message</code>.</li>
</ul></li>
</ul></li>
<li>inherited <code>Error</code> properties.</li>
</ul>

<p>It also supports the following method:</p>

<ul>
<li><code>reformat()</code> - rebuilds <code>error.response</code> using the other object properties.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">badRequest</span><span class="p">(</span><span class="s1">'Cannot feed after midnight'</span><span class="p">);</span>
    <span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="mi">499</span><span class="p">;</span>    <span class="c1">// Assign a custom error code</span>
    <span class="nx">error</span><span class="p">.</span><span class="nx">reformat</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<h3 id="error-transformation">Error transformation</h3>

<p>Error responses return a JSON object with the <code>code</code>, <code>error</code>, and <code>message</code> keys. When a different error representation is desired, such
as an HTML page or using another format, the <code>'onPreResponse'</code> extension point may be used to identify errors and replace them with a different
response object.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">({</span> <span class="nx">views</span><span class="o">:</span> <span class="p">{</span> <span class="nx">engines</span><span class="o">:</span> <span class="p">{</span> <span class="nx">html</span><span class="o">:</span> <span class="s1">'handlebars'</span> <span class="p">}</span> <span class="p">}</span> <span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">ext</span><span class="p">(</span><span class="s1">'onPreResponse'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">response</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">isBoom</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Replace error with friendly HTML</span>

      <span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="nx">response</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">message</span><span class="o">:</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">code</span> <span class="o">===</span> <span class="mi">404</span> <span class="o">?</span> <span class="s1">'page not found'</span> <span class="o">:</span> <span class="s1">'something went wrong'</span><span class="p">)</span>
      <span class="p">};</span>

      <span class="nx">next</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">generateView</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="nx">context</span><span class="p">));</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="badrequest--message--"><code>badRequest([message])</code></h4>

<p>Returns an HTTP Bad Request (400) error response object with the provided <code>message</code>.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="nx">Hapi</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">badRequest</span><span class="p">(</span><span class="s1">'Invalid parameter value'</span><span class="p">);</span>
</code></pre></div>
<h4 id="unauthorized-message---scheme---attributes---"><code>unauthorized(message, [scheme, [attributes]])</code></h4>

<p>Returns an HTTP Unauthorized (401) error response object where:</p>

<ul>
<li><code>message</code> - the error message.</li>
<li><code>scheme</code> - optional HTTP authentication scheme name (e.g. <code>'Basic'</code>, <code>'Hawk'</code>). If provided, includes the HTTP 'WWW-Authenticate'
response header with the scheme and any provided <code>attributes</code>.</li>
<li><code>attributes</code> - an object where each key is an HTTP header attribute and value is the attribute content.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="nx">Hapi</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">unauthorized</span><span class="p">(</span><span class="s1">'Stale timestamp'</span><span class="p">,</span> <span class="s1">'Hawk'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">ts</span><span class="o">:</span> <span class="nx">fresh</span><span class="p">,</span> <span class="nx">tsm</span><span class="o">:</span> <span class="nx">tsm</span> <span class="p">});</span>
</code></pre></div>
<h4 id="unauthorized-message--wwwauthenticate-"><code>unauthorized(message, wwwAuthenticate)</code></h4>

<p>Returns an HTTP Unauthorized (401) error response object where:</p>

<ul>
<li><code>message</code> - the error message.</li>
<li><code>wwwAuthenticate</code> - an array of HTTP 'WWW-Authenticate' header responses for multiple challenges.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="nx">Hapi</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">unauthorized</span><span class="p">(</span><span class="s1">'Missing authentication'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'Hawk'</span><span class="p">,</span> <span class="s1">'Basic'</span><span class="p">]);</span>
</code></pre></div>
<h4 id="clienttimeout--message--"><code>clientTimeout([message])</code></h4>

<p>Returns an HTTP Request Timeout (408) error response object with the provided <code>message</code>.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="nx">Hapi</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">clientTimeout</span><span class="p">(</span><span class="s1">'This is taking too long'</span><span class="p">);</span>
</code></pre></div>
<h4 id="servertimeout--message--"><code>serverTimeout([message])</code></h4>

<p>Returns an HTTP Service Unavailable (503) error response object with the provided <code>message</code>.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="nx">Hapi</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">serverTimeout</span><span class="p">(</span><span class="s1">'Too busy, come back later'</span><span class="p">);</span>
</code></pre></div>
<h4 id="forbidden--message--"><code>forbidden([message])</code></h4>

<p>Returns an HTTP Forbidden (403) error response object with the provided <code>message</code>.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="nx">Hapi</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">forbidden</span><span class="p">(</span><span class="s1">'Missing permissions'</span><span class="p">);</span>
</code></pre></div>
<h4 id="notfound--message--"><code>notFound([message])</code></h4>

<p>Returns an HTTP Not Found (404) error response object with the provided <code>message</code>.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="nx">Hapi</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">notFound</span><span class="p">(</span><span class="s1">'Wrong number'</span><span class="p">);</span>
</code></pre></div>
<h4 id="internal--message---data---"><code>internal([message, [data]])</code></h4>

<p>Returns an HTTP Internal Server Error (500) error response object where:</p>

<ul>
<li><code>message</code> - the error message.</li>
<li><code>data</code> - optional data used for error logging. Typically set to the <code>Error</code> object causing the failure.</li>
</ul>

<p>The returned error object includes the following additional properties:</p>

<ul>
<li><code>data</code> - the <code>data</code> object provided.</li>
<li><code>trace</code> - the call stack leading to this error. If <code>data</code> is an <code>Error</code> object, <code>trace</code> is set to <code>data.trace</code>.</li>
<li><code>outterTrace</code> - If <code>data</code> is an <code>Error</code> object, set to the call stack leading to this error, otherwise <code>null</code>.</li>
</ul>

<p>Note that the <code>error.response.payload.message</code> is overridden with <code>'An internal server error occurred'</code> to hide any internal details from
the client. <code>error.message</code> remains unchanged.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">result</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">internal</span><span class="p">(</span><span class="s1">'Failed parsing JSON input'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="passthrough-code--payload--contenttype--headers-"><code>passThrough(code, payload, contentType, headers)</code></h4>

<p>Returns a custom HTTP error response object where:</p>

<ul>
<li><code>code</code> - the HTTP status code (typically 4xx or 5xx).</li>
<li><code>payload</code> - the error payload string or <code>Buffer</code>.</li>
<li><code>contentType</code> - a mime-type used as the content of the HTTP 'Content-Type' header (overrides <code>headers['Content-Type']</code> if present in both).</li>
<li><code>headers</code> - an object containing any HTTP headers where each key is a header name and value is the header content.</li>
</ul>

<p>Used to pass-through errors received from upstream services (proxied) when a response should be treated internally as an error but contain
custom properties.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="nx">Hapi</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">passThrough</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s1">'&lt;h1&gt;Not Found&lt;/h1&gt;'</span><span class="p">,</span> <span class="s1">'text/html'</span><span class="p">,</span> <span class="p">{</span> <span class="s1">'Cache-Control'</span><span class="o">:</span> <span class="s1">'no-cache'</span> <span class="p">});</span>
</code></pre></div>
<h2 id="hapi-pack"><code>Hapi.Pack</code></h2>

<p><code>Pack</code> is a collection of servers grouped together to form a single logical unit. The pack's primary purpose is to provide a unified object
interface when working with <a href="http://spumko.github.io/resource/api/#plugin-interface">plugins</a>. Grouping multiple servers into a single pack enables treating them as a single
entity which can start and stop in sync, as well as enable sharing routes and other facilities.</p>

<p>The servers in a pack share the same cache. Every server belongs to a pack, even if created directed via
<a href="http://spumko.github.io/resource/api/#new-serverhost-port-options"><code>new Server()</code></a>, in which case the <code>server.pack</code> object is automatically assigned a single-server pack.</p>

<h4 id="new-pack--options--"><code>new Pack([options])</code></h4>

<p>Creates a new <code>Pack</code> object instance where:</p>

<ul>
<li><code>options</code> - optional configuration:

<ul>
<li><code>app</code> - an object used to initialize the application-specific data stored in <code>pack.app</code>.</li>
<li><code>cache</code> - cache configuration as described in the server <a href="http://spumko.github.io/resource/api/#server.config.cache"><code>cache</code></a> option.</li>
<li><code>requirePath</code> - sets the path from which node module plugins are loaded. Applies only when using <code>pack.require()</code>[#packrequirename-options-callback]
with module names that do no include a relative or absolute path (e.g. 'lout'). Defaults to the node module behaviour described in
<a href="http://nodejs.org/api/modules.html#modules_loading_from_node_modules_folders">node modules</a>. Note that if the modules
are located inside a 'node_modules' sub-directory, <code>requirePath</code> must end with <code>'/node_modules'</code>.</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">pack</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Pack</span><span class="p">();</span>
</code></pre></div>
<h3 id="pack-properties"><code>Pack</code> properties</h3>

<p>Each <code>Pack</code> object instance has the following properties:</p>

<ul>
<li><code>app</code> - application-specific state. Provides a safe place to store application data without potential conflicts with <strong>hapi</strong>.
Initialized via the pack <code>app</code> configuration option. Defaults to <code>{}</code>.</li>
<li><code>events</code> - an <code>Events.EventEmitter</code> providing a consolidate emitter of all the events emitted from all member pack servers.</li>
<li><code>list</code> - an object listing all the registered plugins where each key is a plugin name and the value is an object with:

<ul>
<li><code>name</code> - plugin name.</li>
<li><code>version</code> - plugin version.</li>
<li><code>path</code> - the plugin root path (where 'package.json' is located).</li>
<li><code>register()</code> - the <a href="http://spumko.github.io/resource/api/#exportsregisterplugin-options-next"><code>exports.register()</code></a> function.</li>
</ul></li>
</ul>

<h3 id="pack-methods"><code>Pack</code> methods</h3>

<h4 id="pack-server--host----port----options--"><code>pack.server([host], [port], [options])</code></h4>

<p>Creates a <code>Server</code> instance and adds it to the pack, where <code>host</code>, <code>port</code>, <code>options</code> are the same as described in
<a href="http://spumko.github.io/resource/api/#new-serverhost-port-options"><code>new Server()</code></a> with the exception that the <code>cache</code> option is not allowed and must be
configured via the pack <code>cache</code> option.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">pack</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Pack</span><span class="p">();</span>

<span class="nx">pack</span><span class="p">.</span><span class="nx">server</span><span class="p">(</span><span class="mi">8000</span><span class="p">,</span> <span class="p">{</span> <span class="nx">labels</span><span class="o">:</span> <span class="p">[</span><span class="s1">'web'</span><span class="p">]</span> <span class="p">});</span>
<span class="nx">pack</span><span class="p">.</span><span class="nx">server</span><span class="p">(</span><span class="mi">8001</span><span class="p">,</span> <span class="p">{</span> <span class="nx">labels</span><span class="o">:</span> <span class="p">[</span><span class="s1">'admin'</span><span class="p">]</span> <span class="p">});</span>
</code></pre></div>
<h4 id="pack-start--callback--"><code>pack.start([callback])</code></h4>

<p>Starts all the servers in the pack and used as described in <a href="http://spumko.github.io/resource/api/#serverstartcallback"><code>server.start([callback])</code></a>.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">pack</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Pack</span><span class="p">();</span>

<span class="nx">pack</span><span class="p">.</span><span class="nx">server</span><span class="p">(</span><span class="mi">8000</span><span class="p">,</span> <span class="p">{</span> <span class="nx">labels</span><span class="o">:</span> <span class="p">[</span><span class="s1">'web'</span><span class="p">]</span> <span class="p">});</span>
<span class="nx">pack</span><span class="p">.</span><span class="nx">server</span><span class="p">(</span><span class="mi">8001</span><span class="p">,</span> <span class="p">{</span> <span class="nx">labels</span><span class="o">:</span> <span class="p">[</span><span class="s1">'admin'</span><span class="p">]</span> <span class="p">});</span>

<span class="nx">pack</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'All servers started'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="pack-stop--options----callback--"><code>pack.stop([options], [callback])</code></h4>

<p>Stops all the servers in the pack and used as described in <a href="http://spumko.github.io/resource/api/#serverstopoptions-callback"><code>server.stop([options], [callback])</code></a>.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">pack</span><span class="p">.</span><span class="nx">stop</span><span class="p">({</span> <span class="nx">timeout</span><span class="o">:</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span> <span class="p">},</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'All servers stopped'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="pack-allow-permissions-"><code>pack.allow(permissions)</code></h4>

<p>Overrides the default plugin permissions when <a href="http://spumko.github.io/resource/api/#packrequirename-options-callback">requiring</a> or <a href="http://spumko.github.io/resource/api/#packregisterplugin-options-callback">registering</a>
a plugin. Where:</p>

<ul>
<li><code>permissions</code> - an object where each key is a permission name and the value is a boolean set to <code>true</code> (allow) or <code>false</code> (deny) access.</li>
</ul>

<p>Returns a plugin registration interface with the <code>pack.require()</code> and <code>pack.register()</code> methods.</p>

<p>The default permissions are:</p>

<ul>
<li><code>auth</code> - allows registering an authentication strategy via <a href="http://spumko.github.io/resource/api/#pluginauthname-options"><code>plugin.auth()</code></a>. Defaults to <code>true</code>.</li>
<li><code>cache</code> - allows provisioning a plugin cache segment via <a href="http://spumko.github.io/resource/api/#plugincacheoptions"><code>plugin.cache()</code></a>. Defaults to <code>true</code>.</li>
<li><code>events</code> - allows access to events via <a href="http://spumko.github.io/resource/api/#pluginevents"><code>plugin.events</code></a>. Defaults to <code>true</code>.</li>
<li><code>ext</code>- allows registering extension methods via <a href="http://spumko.github.io/resource/api/#pluginextevent-method-options"><code>plugin.ext()</code></a>. Defaults to <code>false</code>.</li>
<li><code>helper</code> - allows addming server helper methods via <a href="http://spumko.github.io/resource/api/#pluginhelpername-method-options"><code>plugin.helper()</code></a>. Defaults to <code>true</code>.</li>
<li><code>route</code> - allows adding routes via <a href="http://spumko.github.io/resource/api/#pluginrouteoptions"><code>plugin.route()</code></a>. Defaults to <code>true</code>.</li>
<li><code>state</code> - allows configuring state definitions via <a href="http://spumko.github.io/resource/api/#pluginstatename-options"><code>plugin.state()</code></a>. Defaults to <code>true</code>.</li>
<li><code>views</code> - allows configuring a plugin-specific views manager via <a href="http://spumko.github.io/resource/api/#pluginviewsoptions"><code>plugin.views()</code></a>. Defaults to <code>true</code>.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">pack</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Pack</span><span class="p">();</span>

<span class="nx">pack</span><span class="p">.</span><span class="nx">server</span><span class="p">(</span><span class="mi">8000</span><span class="p">,</span> <span class="p">{</span> <span class="nx">labels</span><span class="o">:</span> <span class="p">[</span><span class="s1">'web'</span><span class="p">]</span> <span class="p">});</span>
<span class="nx">pack</span><span class="p">.</span><span class="nx">server</span><span class="p">(</span><span class="mi">8001</span><span class="p">,</span> <span class="p">{</span> <span class="nx">labels</span><span class="o">:</span> <span class="p">[</span><span class="s1">'admin'</span><span class="p">]</span> <span class="p">});</span>

<span class="nx">pack</span><span class="p">.</span><span class="nx">allow</span><span class="p">({</span> <span class="nx">ext</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}).</span><span class="nx">require</span><span class="p">(</span><span class="s1">'yar'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Failed loading plugin: yar'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="pack-require-name---options---callback-"><code>pack.require(name, [options], callback)</code></h4>

<p>Registers a plugin where:</p>

<ul>
<li><code>name</code> - the node module name as expected by node's <a href="http://nodejs.org/api/modules.html#modules_module_require_id"><code>require()</code></a>. If <code>name</code> is a relative
path it is relative to the location of the file requiring it. If <code>name</code> is not a relative or absolute path (e.g. 'furball'), it is prefixed with the
value of the pack <code>requirePath</code> configuration option when present.</li>
<li><code>options</code> - optional configuration object which is passed to the plugin via the <code>options</code> argument in
<a href="http://spumko.github.io/resource/api/#exportsregisterplugin-options-next"><code>exports.register()</code></a>. If <code>options</code> is an array, the first array item is used as <a href="http://spumko.github.io/resource/api/#packallowpermissions"><code>permissions</code></a>,
and the second item is used as <code>options</code>.</li>
<li><code>callback</code> - the callback function with signature <code>function(err)</code> where:

<ul>
<li><code>err</code> - an error returned from <code>exports.register()</code>. Note that incorrect usage, bad configuration, missing permissions, or namespace conflicts
(e.g. among routes, helpers, state) will throw an error and will not return a callback.</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">pack</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s1">'furball'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">version</span><span class="o">:</span> <span class="s1">'/v'</span> <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Failed loading plugin: furball'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="pack-require-names--callback-"><code>pack.require(names, callback)</code></h4>

<p>Registers a list of plugins where:</p>

<ul>
<li><code>names</code> - an array of plugins names as described in <a href="http://spumko.github.io/resource/api/#packrequirename-options-callback"><code>pack.require()</code></a>, or an object in which
each key is a plugin name, and each value is the <code>options</code> object used to register that plugin. If the <code>options</code> value is an array,
the first array item is used as <a href="http://spumko.github.io/resource/api/#packallowpermissions"><code>permissions</code></a>, and the second item is used as <code>options</code>.</li>
<li><code>callback</code> - the callback function with signature <code>function(err)</code> where:

<ul>
<li><code>err</code> - an error returned from <code>exports.register()</code>. Note that incorrect usage, bad configuration, missing permissions, or namespace conflicts
(e.g. among routes, helpers, state) will throw an error and will not return a callback.</li>
</ul></li>
</ul>

<p>Batch registration is required when plugins declare a <a href="http://spumko.github.io/resource/api/#plugindependencydeps">dependency</a>, so that all the required dependencies are loaded in
a single transaction (internal order does not matter).</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">pack</span><span class="p">.</span><span class="nx">require</span><span class="p">([</span><span class="s1">'furball'</span><span class="p">,</span> <span class="s1">'lout'</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Failed loading plugin: furball'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">pack</span><span class="p">.</span><span class="nx">require</span><span class="p">({</span> <span class="nx">furball</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">lout</span><span class="o">:</span> <span class="p">{</span> <span class="nx">endpoint</span><span class="o">:</span> <span class="s1">'/docs'</span> <span class="p">}</span> <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Failed loading plugins'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="pack-register-plugin--options--callback-"><code>pack.register(plugin, options, callback)</code></h4>

<p>Registers a plugin object (without using <code>require()</code>) where:</p>

<ul>
<li><code>plugin</code> - the plugin object which requires:

<ul>
<li><code>name</code> - plugin name.</li>
<li><code>version</code> - plugin version.</li>
<li><code>path</code> - optional plugin path for resolving relative paths used by the plugin. Defaults to current working directory.</li>
<li><code>register()</code> - the <a href="http://spumko.github.io/resource/api/#exportsregisterplugin-options-next"><code>exports.register()</code></a> function.</li>
</ul></li>
<li><code>options</code> - optional configuration object which is passed to the plugin via the <code>options</code> argument in
<a href="http://spumko.github.io/resource/api/#exportsregisterplugin-options-next"><code>exports.register()</code></a>. If <code>options</code> is an array, the first array item is used as <a href="http://spumko.github.io/resource/api/#packallowpermissions"><code>permissions</code></a>,
and the second item is used as <code>options</code>.</li>
<li><code>callback</code> - the callback function with signature <code>function(err)</code> where:

<ul>
<li><code>err</code> - an error returned from <code>exports.register()</code>. Note that incorrect usage, bad configuration, missing permissions, or namespace conflicts
(e.g. among routes, helpers, state) will throw an error and will not return a callback.</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">plugin</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">'test'</span><span class="p">,</span>
    <span class="nx">version</span><span class="o">:</span> <span class="s1">'2.0.0'</span><span class="p">,</span>
    <span class="nx">register</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">pack</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">pack</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/special'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);</span>
        <span class="nx">next</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">pack</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="p">{</span> <span class="nx">message</span><span class="o">:</span> <span class="s1">'hello'</span> <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Failed loading plugin'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<h2 id="hapi-composer"><code>Hapi.Composer</code></h2>

<p>The <code>Composer</code> provides a simple way to construct a <a href="http://spumko.github.io/resource/api/#hapipack"><code>Pack</code></a> from a single configuration object, including configuring servers
and registering plugins.</p>

<h4 id="new-composer-manifest-"><code>new Composer(manifest)</code></h4>

<p>Creates a <code>Composer</code> object instance where:</p>

<ul>
<li><code>manifest</code> - an object or array or objects where:

<ul>
<li><code>pack</code> - the pack <code>options</code> as described in <a href="http://spumko.github.io/resource/api/#packserverhost-port-options"><code>new Pack()</code></a>.</li>
<li><code>servers</code> - an array of server configuration objects where:

<ul>
<li><code>host</code>, <code>port</code>, <code>options</code> - the same as described in <a href="http://spumko.github.io/resource/api/#new-serverhost-port-options"><code>new Server()</code></a> with the exception that the
<code>cache</code> option is not allowed and must be configured via the pack <code>cache</code> option. The <code>host</code> and <code>port</code> keys can be set to an environment variable by prefixing the variable name with <code>'$env.'</code>.</li>
</ul></li>
<li><code>plugin</code> - an object where each key is a plugin name, and each value is the <code>options</code> object used to register that plugin. If the <code>options</code>
value is an array, the first array item is used as <a href="http://spumko.github.io/resource/api/#packallowpermissions"><code>permissions</code></a>, and the second item is used as <code>options</code>.</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">manifest</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">pack</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">cache</span><span class="o">:</span> <span class="s1">'memory'</span>
    <span class="p">},</span>
    <span class="nx">servers</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nx">port</span><span class="o">:</span> <span class="mi">8000</span><span class="p">,</span>
            <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">labels</span><span class="o">:</span> <span class="p">[</span><span class="s1">'web'</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nx">host</span><span class="o">:</span> <span class="s1">'localhost'</span><span class="p">,</span>
            <span class="nx">port</span><span class="o">:</span> <span class="mi">8001</span><span class="p">,</span>
            <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">labels</span><span class="o">:</span> <span class="p">[</span><span class="s1">'admin'</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="nx">plugins</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">'yar'</span><span class="o">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="nx">ext</span><span class="o">:</span> <span class="kc">true</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="nx">cookieOptions</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">password</span><span class="o">:</span> <span class="s1">'secret'</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">composer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Composer</span><span class="p">(</span><span class="nx">manifest</span><span class="p">);</span>
</code></pre></div>
<h4 id="composer-compose-callback-"><code>composer.compose(callback)</code></h4>

<p>Creates the packs described in the manifest construction where:</p>

<ul>
<li><code>callback</code> - the callback method, called when all packs and servers have been created and plugins registered has the signature
<code>function(err)</code> where:

<ul>
<li><code>err</code> - an error returned from <code>exports.register()</code>. Note that incorrect usage, bad configuration, missing permissions, or namespace conflicts
(e.g. among routes, helpers, state) will throw an error and will not return a callback.</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">composer</span><span class="p">.</span><span class="nx">compose</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Failed composing'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="composer-start--callback--"><code>composer.start([callback])</code></h4>

<p>Starts all the servers in all the pack composed where:</p>

<ul>
<li><code>callback</code> - the callback method called when all the servers have been started.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">composer</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'All servers started'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="composer-stop--options----callback--"><code>composer.stop([options], [callback])</code></h4>

<p>Stops all the servers in all the packs and used as described in <a href="http://spumko.github.io/resource/api/#serverstopoptions-callback"><code>server.stop([options], [callback])</code></a>.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">pack</span><span class="p">.</span><span class="nx">stop</span><span class="p">({</span> <span class="nx">timeout</span><span class="o">:</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span> <span class="p">},</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'All servers stopped'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<h2 id="plugin-interface">Plugin interface</h2>

<p>Plugins provide an extensibility platform for both general purpose utilities such as <a href="https://github.com/spumko/bassmaster">batch requests</a> and for
application business logic. Instead of thinking about a web server as a single entity with a unified routing table, plugins enable developers to
break their application into logical units, assembled together in different combinations to fit the development, testing, and deployment needs.</p>

<p>Constructing a plugin requires the following:</p>

<ul>
<li>name - the plugin name is used as a unique key. Public plugins should be published in the <a href="https://npmjs.org/">npm registry</a> and derive their name
from the registry name. This ensures uniqueness. Private plugin names should be picked carefully to avoid conflicts with both private and public
names. Typically, private plugin names use a prefix such as the company name or an unusual combination of characters (e.g. <code>'--'</code>). When using the
<a href="http://spumko.github.io/resource/api/#packrequirename-options-callback"><code>pack.require()</code></a> interface, the name is obtained from the 'package.json' module file. When using the
<a href="http://spumko.github.io/resource/api/#packregisterplugin-options-callback"><code>pack.register()</code></a> interface, the name is provided as a required key in <code>plugin</code>.</li>
<li>version - the plugin version is only used informatively within the framework but plays an important role in the plugin echo-system. The plugin
echo-system relies on the <a href="http://blog.nodejs.org/2013/02/07/peer-dependencies/">npm peer dependency</a> functionality to ensure that plugins can
specify their dependency on a specific version of <strong>hapi</strong>, as well as on each other. Dependencies are expressed solely within the 'package.json'
file, and are enforced by <strong>npm</strong>. When using the <a href="http://spumko.github.io/resource/api/#packrequirename-options-callback"><code>pack.require()</code></a> interface, the version is obtained from
the 'package.json' module file. When using the <a href="http://spumko.github.io/resource/api/#packregisterplugin-options-callback"><code>pack.register()</code></a> interface, the version is provided as
a required key in <code>plugin</code>.</li>
<li><code>exports.register()</code> - the registration function described in <a href="http://spumko.github.io/resource/api/#exportsregisterplugin-options-next"><code>exports.register()</code></a> is the plugin's core.
The function is called when the plugin is registered and it performs all the activities required by the plugin to operate. It is the single entry
point into the plugin functionality. When using the <a href="http://spumko.github.io/resource/api/#packrequirename-options-callback"><code>pack.require()</code></a> interface, the function is obtained by
<a href="http://nodejs.org/api/modules.html#modules_module_require_id"><code>require()</code></a>'ing the plugin module and invoking the exported <code>register()</code> method.
When using the <a href="http://spumko.github.io/resource/api/#packregisterplugin-options-callback"><code>pack.register()</code></a> interface, the function is provided as a required key in <code>plugin</code>.</li>
</ul>

<p><strong>package.json</strong></p>
<div class="highlight"><pre><code class="json language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"furball"</span><span class="p">,</span>
  <span class="nt">"description"</span><span class="p">:</span> <span class="s2">"Plugin utilities and endpoints"</span><span class="p">,</span>
  <span class="nt">"version"</span><span class="p">:</span> <span class="s2">"0.3.0"</span><span class="p">,</span>
  <span class="nt">"main"</span><span class="p">:</span> <span class="s2">"index"</span><span class="p">,</span>
  <span class="nt">"dependencies"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"hoek"</span><span class="p">:</span> <span class="s2">"0.8.x"</span>
  <span class="p">},</span>
  <span class="nt">"peerDependencies"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"hapi"</span><span class="p">:</span> <span class="s2">"1.x.x"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>index.js</strong></p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hoek</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hoek'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">internals</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">defaults</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">version</span><span class="o">:</span> <span class="s1">'/version'</span><span class="p">,</span>
        <span class="nx">plugins</span><span class="o">:</span> <span class="s1">'/plugins'</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">internals</span><span class="p">.</span><span class="nx">version</span> <span class="o">=</span> <span class="nx">Hoek</span><span class="p">.</span><span class="nx">loadPackage</span><span class="p">().</span><span class="nx">version</span><span class="p">;</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">settings</span> <span class="o">=</span> <span class="nx">Hoek</span><span class="p">.</span><span class="nx">applyToDefaults</span><span class="p">(</span><span class="nx">internals</span><span class="p">.</span><span class="nx">defaults</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">version</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">plugin</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
            <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span>
            <span class="nx">path</span><span class="o">:</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">version</span><span class="p">,</span>
            <span class="nx">handler</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

                <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">internals</span><span class="p">.</span><span class="nx">version</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">plugins</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">plugin</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
            <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span>
            <span class="nx">path</span><span class="o">:</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">plugins</span><span class="p">,</span>
            <span class="nx">handler</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

                <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">listPlugins</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">listPlugins</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">server</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">plugins</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">server</span><span class="p">.</span><span class="nx">pack</span><span class="p">.</span><span class="nx">list</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>

            <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">server</span><span class="p">.</span><span class="nx">pack</span><span class="p">.</span><span class="nx">list</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
            <span class="nx">plugins</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
                <span class="nx">name</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
                <span class="nx">version</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">version</span>
            <span class="p">});</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="nx">plugins</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">plugin</span><span class="p">.</span><span class="nx">api</span><span class="p">(</span><span class="s1">'plugins'</span><span class="p">,</span> <span class="nx">listPlugins</span><span class="p">);</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="exports-register-plugin--options--next-"><code>exports.register(plugin, options, next)</code></h4>

<p>Registers the plugin where:</p>

<ul>
<li><code>plugin</code> - the registration interface representing the pack the plugin is being registered into. Provides the properties and methods listed below, based
on the permissions granted.</li>
<li><code>options</code> - the <code>options</code> object provided by the pack registration methods.</li>
<li><code>next</code> - the callback function the plugin must call to return control over to the application and complete the registration process. The function
signature is <code>function(err)</code> where:

<ul>
<li><code>err</code> - internal plugin error condition, which is returned back via the registration methods' callback. A plugin registration error is considered
an unrecoverable event which should terminate the application.</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">plugin</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s1">'hello world'</span><span class="p">)</span> <span class="p">}</span> <span class="p">});</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="root-methods-and-properties">Root methods and properties</h3>

<p>The plugin interface root methods and properties are those available only on the <code>plugin</code> object received via the
<a href="http://spumko.github.io/resource/api/#exportsregisterplugin-options-next"><code>exports.register()</code></a> interface. They are not available on the object received by calling
<a href="http://spumko.github.io/resource/api/#pluginselectlabels"><code>plugin.select()</code></a>.</p>

<h4 id="plugin-version"><code>plugin.version</code></h4>

<p>The plugin version information.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">plugin</span><span class="p">.</span><span class="nx">version</span><span class="p">);</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="plugin-path"><code>plugin.path</code></h4>

<p>The plugin root path (where 'package.json' resides).</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">Fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">plugin</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s1">'/resources/image.png'</span><span class="p">);</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="plugin-hapi"><code>plugin.hapi</code></h4>

<p>A reference to the <strong>hapi</strong> module used to create the pack and server instances. Removes the need to add a dependency on <strong>hapi</strong> within the plugin.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">plugin</span><span class="p">.</span><span class="nx">hapi</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">Hapi</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">internal</span><span class="p">(</span><span class="s1">'Not implemented yet'</span><span class="p">));</span>
    <span class="p">};</span>

    <span class="nx">plugin</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">handler</span> <span class="p">});</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="plugin-app"><code>plugin.app</code></h4>

<p>Provides access to the <a href="http://spumko.github.io/resource/api/#pack-properties">common pack application-specific state</a>.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">plugin</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">hapi</span> <span class="o">=</span> <span class="s1">'joi'</span><span class="p">;</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="plugin-events"><code>plugin.events</code></h4>

<p><em>Requires the <code>events</code> plugin permission.</em></p>

<p>The `pack.events' emitter.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">plugin</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'internalError'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="plugin-log-tags---data---timestamp---"><code>plugin.log(tags, [data, [timestamp]])</code></h4>

<p>Emits a <code>'log'</code> event on the <code>pack.events' emitter using the same interface as [</code>server.log()`](#serverlogtags-data-timestamp).</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">plugin</span><span class="p">.</span><span class="nx">log</span><span class="p">([</span><span class="s1">'plugin'</span><span class="p">,</span> <span class="s1">'info'</span><span class="p">],</span> <span class="s1">'Plugin registered'</span><span class="p">);</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="plugin-dependency-deps-"><code>plugin.dependency(deps)</code></h4>

<p>Declares a required dependency upon other plugins where:</p>

<ul>
<li><code>deps</code> - a single string or array of strings of plugin names which must be registered in order for this plugin to operate. Plugins listed
must be registered in the same pack transaction to allow validation of the dependency requirements. Does not provide version dependency which
should be implemented using <a href="http://blog.nodejs.org/2013/02/07/peer-dependencies/">npm peer dependencies</a>.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">plugin</span><span class="p">.</span><span class="nx">dependecy</span><span class="p">(</span><span class="s1">'yar'</span><span class="p">);</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="plugin-views-options-"><code>plugin.views(options)</code></h4>

<p><em>Requires the <code>views</code> plugin permission.</em></p>

<p>Generates a plugin-specific views manager for rendering templates where:
- <code>options</code> - the views configuration as described in the server's <a href="http://spumko.github.io/resource/api/#server.config.views"><code>views</code></a> option. Note that due to the way node
  <code>require()</code> operates, plugins must require rendering engines directly and pass the engine using the <code>engines.module</code> option.</p>

<p>Note that relative paths are relative to the plugin root, not the working directory or the application registering the plugin. This allows
plugin the specify their own static resources without having to require external configuration.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">plugin</span><span class="p">.</span><span class="nx">views</span><span class="p">({</span>
        <span class="nx">engines</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">jade</span><span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'jade'</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="nx">path</span><span class="o">:</span> <span class="s1">'./templates'</span>
    <span class="p">});</span>

    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="plugin-helper-name--method---options--"><code>plugin.helper(name, method, [options])</code></h4>

<p><em>Requires the <code>helper</code> plugin permission.</em></p>

<p>Registers a server helper function with all the pack's servers as described in <a href="http://spumko.github.io/resource/api/#serverhelpername-method-options"><code>server.helper()</code></a></p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">plugin</span><span class="p">.</span><span class="nx">helper</span><span class="p">(</span><span class="s1">'user'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">next</span><span class="p">({</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span> <span class="p">});</span>
    <span class="p">});</span>

    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="plugin-cache-options-"><code>plugin.cache(options)</code></h4>

<p><em>Requires the <code>cache</code> plugin permission.</em></p>

<p>Provisions a plugin cache segment within the pack's common caching facility where:</p>

<ul>
<li><code>options</code> - cache configuration as described in <a href="https://github.com/spumko/catbox#policy"><strong>catbox</strong> module documentation</a>:

<ul>
<li><code>expiresIn</code> - relative expiration expressed in the number of milliseconds since the item was saved in the cache. Cannot be used
together with <code>expiresAt</code>.</li>
<li><code>expiresAt</code> - time of day expressed in 24h notation using the 'MM:HH' format, at which point all cache records for the route
expire. Cannot be used together with <code>expiresIn</code>.</li>
<li><code>staleIn</code> - number of milliseconds to mark an item stored in cache as stale and reload it. Must be less than <code>expiresIn</code>.</li>
<li><code>staleTimeout</code> - number of milliseconds to wait before checking if an item is stale.</li>
<li><code>segment</code> - optional segment name, used to isolate cached items within the cache partition. Defaults to '!name' where 'name' is the
plugin name. When setting segment manually, it must begin with '!!'.</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">cache</span> <span class="o">=</span> <span class="nx">plugin</span><span class="p">.</span><span class="nx">cache</span><span class="p">({</span> <span class="nx">expiresIn</span><span class="o">:</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span> <span class="p">});</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="selectable-methods-and-properties">Selectable methods and properties</h3>

<p>The plugin interface selectable methods and properties are those available both on the <code>plugin</code> object received via the
<a href="http://spumko.github.io/resource/api/#exportsregisterplugin-options-next"><code>exports.register()</code></a> interface and the objects received by calling
<a href="http://spumko.github.io/resource/api/#pluginselectlabels"><code>plugin.select()</code></a>. However, unlike the root methods, they operate only on the selected subset of
servers.</p>

<h4 id="plugin-select-labels-"><code>plugin.select(labels)</code></h4>

<p>Selects a subset of pack servers using the servers' <code>labels</code> configuration option where:</p>

<ul>
<li><code>labels</code> - a single string or array of strings of labels used as a logical OR statement to select all the servers with matching
labels in their configuration.</li>
</ul>

<p>Returns a new <code>plugin</code> interface with only access to the <a href="http://spumko.github.io/resource/api/#selectable-methods-and-properties">selectable methods and properties</a>.
Selecting again on a selection operates as a logic AND statement between the individual selections.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">selection</span> <span class="o">=</span> <span class="nx">plugin</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">'web'</span><span class="p">);</span>
    <span class="nx">selection</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="s1">'notfound'</span> <span class="p">});</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="plugin-length"><code>plugin.length</code></h4>

<p>The number of selected servers.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="nx">plugin</span><span class="p">.</span><span class="nx">lenght</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">selectedCount</span> <span class="o">=</span> <span class="nx">plugin</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">'web'</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="plugin-api-key--value-"><code>plugin.api(key, value)</code></h4>

<p>Adds an plugin API to the <code>server.plugins[name]</code> ('name' of plugin) object of each selected pack server where:</p>

<ul>
<li><code>key</code> - the key assigned (<code>server.plugins[name][key]</code>).</li>
<li><code>value</code> - the value assigned.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">plugin</span><span class="p">.</span><span class="nx">api</span><span class="p">(</span><span class="s1">'util'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'something'</span><span class="p">);</span> <span class="p">});</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="plugin-api-obj-"><code>plugin.api(obj)</code></h4>

<p>Merges a deep copy of an object into to the existing content of the <code>server.plugins[name]</code> ('name' of plugin) object of each
selected pack server where:</p>

<ul>
<li><code>obj</code> - the object merged into the API container.</li>
</ul>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">plugin</span><span class="p">.</span><span class="nx">api</span><span class="p">({</span> <span class="nx">util</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'something'</span><span class="p">);</span> <span class="p">}</span> <span class="p">});</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="plugin-route-options-"><code>plugin.route(options)</code></h4>

<p><em>Requires the <code>route</code> plugin permission.</em></p>

<p>Adds a server route to the selected pack's servers as described in <a href="http://spumko.github.io/resource/api/#serverrouteoptions"><code>server.route(options)</code></a>.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">selection</span> <span class="o">=</span> <span class="nx">plugin</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">'web'</span><span class="p">);</span>
    <span class="nx">selection</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="s1">'notfound'</span> <span class="p">});</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="plugin-route-routes-"><code>plugin.route(routes)</code></h4>

<p><em>Requires the <code>route</code> plugin permission.</em></p>

<p>Adds multiple server routes to the selected pack's servers as described in <a href="http://spumko.github.io/resource/api/#serverrouteroutes"><code>server.route(routes)</code></a>.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">selection</span> <span class="o">=</span> <span class="nx">plugin</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">'admin'</span><span class="p">);</span>
    <span class="nx">selection</span><span class="p">.</span><span class="nx">routes</span><span class="p">([</span>
        <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/1'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="s1">'notfound'</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">'/2'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="s1">'notfound'</span> <span class="p">}</span>
    <span class="p">]);</span>

    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="plugin-state-name---options--"><code>plugin.state(name, [options])</code></h4>

<p><em>Requires the <code>state</code> plugin permission.</em></p>

<p>Adds a state definition to the selected pack's servers as described in <a href="http://spumko.github.io/resource/api/#serverstatename-options"><code>server.state()</code></a>.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">plugin</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="s1">'example'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">encoding</span><span class="o">:</span> <span class="s1">'base64'</span> <span class="p">});</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="plugin-auth-name--options-"><code>plugin.auth(name, options)</code></h4>

<p><em>Requires the <code>auth</code> plugin permission.</em></p>

<p>Adds an authentication strategy to the selected pack's servers as described in <a href="http://spumko.github.io/resource/api/#serverauthname-options"><code>server.auth()</code></a>.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">plugin</span><span class="p">.</span><span class="nx">auth</span><span class="p">(</span><span class="s1">'simple'</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">scheme</span><span class="o">:</span> <span class="s1">'basic'</span><span class="p">,</span>
        <span class="nx">validateFunc</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>

            <span class="nx">callback</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'User not found'</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="plugin-ext-event--method---options--"><code>plugin.ext(event, method, [options])</code></h4>

<p><em>Requires the <code>ext</code> plugin permission.</em></p>

<p>Adds an extension point method to the selected pack's servers as described in <a href="http://spumko.github.io/resource/api/#serverextevent-method-options"><code>server.ext()</code></a>.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">plugin</span><span class="p">.</span><span class="nx">ext</span><span class="p">(</span><span class="s1">'onRequest'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">extNext</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Received request: '</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">path</span><span class="p">);</span>
        <span class="nx">extNext</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h2 id="hapi-utils"><code>Hapi.utils</code></h2>

<p>An alias of the <a href="https://github.com/spumko/hoek"><strong>hoek</strong></a> module.</p>

<h4 id="version--"><code>version()</code></h4>

<p>Returns the <strong>hapi</strong> module version number.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Hapi</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">version</span><span class="p">());</span>
</code></pre></div>
<h2 id="hapi-types"><code>Hapi.types</code></h2>

<p>See <a href="https://github.com/spumko/joi#type-registry"><strong>joi</strong> Types</a>.</p>

<h2 id="hapi-state"><code>Hapi.state</code></h2>

<h4 id="preparevalue-name--value--options--callback-"><code>prepareValue(name, value, options, callback)</code></h4>

<p>Prepares a cookie value manually outside of the normal outgoing cookies processing flow. Used when decisions have to be made about
the use of cookie values when certain conditions are met (e.g. stringified object string too long). Arguments:</p>

<ul>
<li><code>name</code> - the cookie name.</li>
<li><code>value</code> - the cookie value. If no <code>encoding</code> is defined, must be a string.</li>
<li><code>options</code> - configuration override. If the state was previously registered with the server using <a href="http://spumko.github.io/resource/api/#serverstatename-options"><code>server.state()</code></a>,
the specified keys in <code>options</code> override those same keys in the server definition (but not others).</li>
<li><code>callback</code> - the callback function with signature <code>function(err, value)</code> where:

<ul>
<li><code>err</code> - internal error condition.</li>
<li><code>value</code> - the prepared cookie value.</li>
</ul></li>
</ul>

<p>Returns the cookie value via callback without making any changes to the response.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hapi'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">maxCookieSize</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">cookieOptions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">encoding</span><span class="o">:</span> <span class="s1">'iron'</span><span class="p">,</span>
        <span class="nx">password</span><span class="o">:</span> <span class="s1">'secret'</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">pre</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>

    <span class="nx">Hapi</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">prepareValue</span><span class="p">(</span><span class="s1">'user'</span><span class="p">,</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">cookieOptions</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">request</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">maxCookieSize</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">request</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="s1">'user'</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="p">{</span> <span class="nx">encoding</span><span class="o">:</span> <span class="s1">'none'</span> <span class="p">}</span> <span class="p">);</span>   <span class="c1">// Already encoded</span>
        <span class="p">}</span>

        <span class="nx">request</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="s1">'success'</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span>
</code></pre></div>
            </div>
        </div>
    </div>
</section>

<script type="text/javascript" src="./hapi_files/vjn6umd.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
<script type="text/javascript" src="./hapi_files/jquery-2.0.0.min.js"></script>
<script type="text/javascript" src="./hapi_files/ui.js"></script>
<script type="text/javascript">
    $(function () {
        $.toc.register();
    });
</script>
<script src="./hapi_files/api.js"></script>



</body></html>